drop extension if exists "pg_net";

create schema if not exists "tooling";

create extension if not exists "pg_trgm" with schema "public";

create extension if not exists "unaccent" with schema "public";

create type "public"."block_type" as enum ('hero', 'cta', 'faq_group', 'rich_text');

create type "public"."token_kind" as enum ('color', 'space', 'radius', 'shadow', 'font', 'size', 'other');

create type "public"."token_scope" as enum ('global', 'theme');

create type "public"."vehicle_image_role" as enum ('exterior', 'interior', 'feature');

create sequence "public"."categories_id_seq";

create sequence "public"."cities_id_seq";

create sequence "public"."faqs_id_seq";

create sequence "public"."states_id_seq";

create sequence "public"."tags_id_seq";

revoke delete on table "public"."content_notes" from "anon";

revoke insert on table "public"."content_notes" from "anon";

revoke references on table "public"."content_notes" from "anon";

revoke select on table "public"."content_notes" from "anon";

revoke trigger on table "public"."content_notes" from "anon";

revoke truncate on table "public"."content_notes" from "anon";

revoke update on table "public"."content_notes" from "anon";

revoke delete on table "public"."content_notes" from "authenticated";

revoke insert on table "public"."content_notes" from "authenticated";

revoke references on table "public"."content_notes" from "authenticated";

revoke select on table "public"."content_notes" from "authenticated";

revoke trigger on table "public"."content_notes" from "authenticated";

revoke truncate on table "public"."content_notes" from "authenticated";

revoke update on table "public"."content_notes" from "authenticated";

revoke delete on table "public"."content_notes" from "service_role";

revoke insert on table "public"."content_notes" from "service_role";

revoke references on table "public"."content_notes" from "service_role";

revoke select on table "public"."content_notes" from "service_role";

revoke trigger on table "public"."content_notes" from "service_role";

revoke truncate on table "public"."content_notes" from "service_role";

revoke update on table "public"."content_notes" from "service_role";

alter table "public"."content_notes" drop constraint "content_notes_point_id_fkey";

alter table "public"."events" drop constraint "events_slug_key";

drop function if exists "public"."fetch_header"(p_page_slug text);

alter table "public"."content_notes" drop constraint "content_notes_pkey";

drop index if exists "public"."content_notes_pkey";

drop index if exists "public"."events_name_idx";

drop table "public"."content_notes";


  create table "public"."amenities111" (
    "id" uuid not null default gen_random_uuid(),
    "city_id" uuid,
    "vehicle_type" text,
    "key" text,
    "label" text,
    "description" text,
    "price_example" text,
    "created_at" timestamp with time zone default now()
      );



  create table "public"."b2r_poll_options" (
    "id" text not null,
    "poll_id" text,
    "option_text" text not null,
    "display_order" integer not null
      );


alter table "public"."b2r_poll_options" enable row level security;


  create table "public"."b2r_poll_votes" (
    "id" bigint generated by default as identity not null,
    "poll_id" text,
    "option_id" text,
    "voted_at" timestamp with time zone not null default now()
      );


alter table "public"."b2r_poll_votes" enable row level security;


  create table "public"."b2r_polls" (
    "id" text not null,
    "created_at" timestamp with time zone not null default now(),
    "question" text not null,
    "category" text not null,
    "tags" text[] default '{}'::text[],
    "group_key" text not null,
    "is_active" boolean default true
      );


alter table "public"."b2r_polls" enable row level security;


  create table "public"."categories1" (
    "id" bigint not null default nextval('public.categories_id_seq'::regclass),
    "name" text not null,
    "slug" text not null
      );


alter table "public"."categories1" enable row level security;


  create table "public"."categories1_csv" (
    "slug" text not null,
    "name" text not null,
    "sort_order" integer,
    "parent_slug" text
      );



  create table "public"."categories1_csv_backup" (
    "slug" text not null,
    "name" text not null,
    "sort_order" integer,
    "parent_slug" text,
    "backup_at" timestamp with time zone
      );



  create table "public"."categories_allowlist" (
    "slug" text not null,
    "name" text,
    "sort_order" integer,
    "parent_slug" text
      );



  create table "public"."cities" (
    "id" bigint not null default nextval('public.cities_id_seq'::regclass),
    "name" text not null,
    "slug" text not null,
    "state_id" bigint not null,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now()
      );


alter table "public"."cities" enable row level security;


  create table "public"."cities111" (
    "id" uuid not null default gen_random_uuid(),
    "name" text not null,
    "slug" text not null,
    "state" text,
    "hero_h1" text,
    "hero_subheading" text,
    "meta_title" text,
    "meta_description" text,
    "created_at" timestamp with time zone default now()
      );



  create table "public"."content_blocks" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null,
    "type" public.block_type not null,
    "variant" text,
    "props" jsonb not null default '{}'::jsonb,
    "status" text default 'published'::text,
    "publish_at" timestamp with time zone,
    "unpublish_at" timestamp with time zone,
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."content_blocks111" (
    "id" uuid not null default gen_random_uuid(),
    "city_id" uuid,
    "vehicle_type" text,
    "block_key" text,
    "title" text,
    "body" text,
    "position" integer default 0,
    "metadata" jsonb,
    "created_at" timestamp with time zone default now()
      );



  create table "public"."design_tokens" (
    "id" uuid not null default gen_random_uuid(),
    "name" text not null,
    "kind" public.token_kind not null,
    "value" text not null,
    "scope" public.token_scope not null default 'global'::public.token_scope,
    "theme_id" uuid,
    "description" text,
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."faqs" (
    "id" bigint not null default nextval('public.faqs_id_seq'::regclass),
    "page_slug" text not null,
    "question" text not null,
    "answer" text not null,
    "sort_order" integer default 0,
    "is_active" boolean default true,
    "created_at" timestamp with time zone default now(),
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."fleet_category_amenities" (
    "category" text not null,
    "amenities" text[] not null default '{}'::text[]
      );



  create table "public"."headers" (
    "id" uuid not null default gen_random_uuid(),
    "page_slug" text not null,
    "title" text,
    "subtitle" text,
    "background_url" text,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now(),
    "is_active" boolean not null default true,
    "phone_display" text,
    "phone_tel" text,
    "email" text,
    "primary_cta" jsonb,
    "secondary_cta" jsonb,
    "tertiary_cta" jsonb,
    "gradient_from" text default 'from-blue-950'::text,
    "gradient_via" text default 'via-blue-900'::text,
    "gradient_to" text default 'to-black'::text,
    "text_color" text default 'text-white'::text,
    "wave_fill" text default '#122a56'::text
      );



  create table "public"."heroes1" (
    "id" uuid not null default gen_random_uuid(),
    "page_slug" text not null,
    "is_active" boolean not null default true,
    "data" jsonb not null,
    "updated_at" timestamp with time zone not null default now(),
    "city_id" uuid,
    "vehicle_type" text,
    "variant" text,
    "style" jsonb
      );


alter table "public"."heroes1" enable row level security;


  create table "public"."heroes1_archive" (
    "id" uuid not null default gen_random_uuid(),
    "page_slug" text not null,
    "is_active" boolean not null default true,
    "data" jsonb not null,
    "updated_at" timestamp with time zone not null default now(),
    "city_id" uuid,
    "vehicle_type" text,
    "archived_at" timestamp with time zone default now()
      );



  create table "public"."homepage_hero" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null default 'home'::text,
    "title" text not null default 'Bus2Ride â€” Group transport made easy'::text,
    "subtitle" text not null default 'Instant quotes, transparent pricing, and clean vehicles for every event.'::text,
    "ctas" jsonb not null default '[{"href": "/contact", "label": "Contact Us", "style": "secondary"}, {"href": "/#fleet", "label": "View Fleet", "style": "primary"}, {"href": "/quote", "label": "Get Instant Quote", "style": "outline"}]'::jsonb,
    "storage_bucket" text not null default 'media'::text,
    "image_keys" text[] not null default '{buses/party1.jpg,buses/party2.jpg,buses/party3.jpg,buses/party4.jpg}'::text[],
    "autoplay_ms" integer not null default 5500,
    "darken" real not null default 0.35,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now()
      );


alter table "public"."homepage_hero" enable row level security;


  create table "public"."images111" (
    "id" uuid not null default gen_random_uuid(),
    "city_id" uuid,
    "vehicle_type" text,
    "storage_path" text,
    "alt_text" text,
    "created_at" timestamp with time zone default now()
      );



  create table "public"."longform111" (
    "id" uuid not null default gen_random_uuid(),
    "city_id" uuid,
    "vehicle_type" text,
    "slug" text,
    "title" text,
    "html_body" text,
    "position" integer default 0,
    "metadata" jsonb,
    "created_at" timestamp with time zone default now()
      );



  create table "public"."page_sections" (
    "id" uuid not null default gen_random_uuid(),
    "position" integer not null default 0,
    "page_slug" text not null default 'home'::text,
    "kind" text not null default 'cta'::text,
    "is_active" boolean not null default true,
    "data" jsonb not null default '{}'::jsonb,
    "updated_at" timestamp with time zone not null default now()
      );



  create table "public"."pages" (
    "id" uuid not null default gen_random_uuid(),
    "route" text not null,
    "title" text,
    "description" text,
    "theme_key" text,
    "updated_at" timestamp with time zone default now(),
    "created_at" timestamp with time zone not null default now()
      );



  create table "public"."poll_categories1" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null,
    "name" text not null,
    "sort_order" integer default 0,
    "created_at" timestamp with time zone default now(),
    "parent_slug" text
      );


alter table "public"."poll_categories1" enable row level security;


  create table "public"."poll_options" (
    "poll_id" text not null,
    "option_id" text not null
      );


alter table "public"."poll_options" enable row level security;


  create table "public"."poll_options1" (
    "id" uuid not null default gen_random_uuid(),
    "poll_id" uuid not null,
    "label" text not null,
    "value" text,
    "sort_order" integer default 0,
    "slug" text not null,
    "ord" integer not null default 0
      );


alter table "public"."poll_options1" enable row level security;


  create table "public"."poll_options_new" (
    "id" uuid not null default extensions.uuid_generate_v4(),
    "poll_id" uuid,
    "option_text" text not null,
    "vote_count" integer default 0
      );


alter table "public"."poll_options_new" enable row level security;


  create table "public"."poll_votes" (
    "poll_id" text not null,
    "option_id" text not null,
    "count" bigint default 0
      );


alter table "public"."poll_votes" enable row level security;


  create table "public"."poll_votes1" (
    "id" uuid not null default gen_random_uuid(),
    "poll_id" uuid not null,
    "option_id" uuid not null,
    "voter_key" text not null,
    "created_at" timestamp with time zone not null default now(),
    "voter_token" text,
    "is_moderated" boolean default true
      );


alter table "public"."poll_votes1" enable row level security;


  create table "public"."poll_votes_new" (
    "id" uuid not null default extensions.uuid_generate_v4(),
    "poll_id" uuid,
    "option_id" uuid,
    "user_identifier" text,
    "created_at" timestamp with time zone default now()
      );


alter table "public"."poll_votes_new" enable row level security;


  create table "public"."polls" (
    "id" text not null,
    "created_at" timestamp with time zone not null default now()
      );


alter table "public"."polls" enable row level security;


  create table "public"."polls1" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null,
    "category_slug" text,
    "question" text not null,
    "multi_select" boolean default false,
    "is_active" boolean default true,
    "meta" jsonb default '{}'::jsonb,
    "created_at" timestamp with time zone default now(),
    "meta_json" jsonb not null default '{}'::jsonb
      );


alter table "public"."polls1" enable row level security;


  create table "public"."polls1_backup" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null,
    "category_slug" text,
    "question" text not null,
    "multi_select" boolean default false,
    "is_active" boolean default true,
    "meta" jsonb default '{}'::jsonb,
    "created_at" timestamp with time zone default now(),
    "meta_json" jsonb not null default '{}'::jsonb,
    "backup_at" timestamp with time zone
      );



  create table "public"."polls_new" (
    "id" uuid not null default extensions.uuid_generate_v4(),
    "slug" text not null,
    "question" text not null,
    "category" text,
    "created_at" timestamp with time zone default now(),
    "expires_at" timestamp with time zone,
    "is_active" boolean default true
      );


alter table "public"."polls_new" enable row level security;


  create table "public"."reviews" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null,
    "source" text not null default 'import'::text,
    "source_id" text,
    "source_url" text,
    "author_display" text not null,
    "rating" smallint,
    "body" text not null,
    "event_slug" text,
    "city_slug" text,
    "state_slug" text,
    "service_date" date,
    "status" text not null default 'published'::text,
    "hash" text not null,
    "created_at" timestamp with time zone not null default now(),
    "created_by" uuid default auth.uid(),
    "featured" boolean default false,
    "approved" boolean default true,
    "published_at" timestamp with time zone
      );


alter table "public"."reviews" enable row level security;


  create table "public"."site_settings" (
    "key" text not null,
    "value" jsonb not null default '{}'::jsonb,
    "updated_at" timestamp with time zone not null default now()
      );


alter table "public"."site_settings" enable row level security;


  create table "public"."sites" (
    "id" uuid not null default gen_random_uuid(),
    "slug" text not null,
    "name" text not null,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now()
      );



  create table "public"."states" (
    "id" bigint not null default nextval('public.states_id_seq'::regclass),
    "name" text not null,
    "slug" text not null,
    "code" text not null,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now()
      );


alter table "public"."states" enable row level security;


  create table "public"."style_tokens" (
    "id" uuid not null default gen_random_uuid(),
    "site_slug" text not null,
    "page_slug" text not null default ''::text,
    "name" text not null default 'default'::text,
    "tokens" jsonb not null,
    "created_at" timestamp with time zone default now(),
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."tags" (
    "id" bigint not null default nextval('public.tags_id_seq'::regclass),
    "name" text not null,
    "slug" text not null
      );


alter table "public"."tags" enable row level security;


  create table "public"."themes" (
    "id" uuid not null default gen_random_uuid(),
    "key" text not null,
    "label" text not null,
    "is_default" boolean default false,
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."tool_code" (
    "tool_id" text not null,
    "version" integer not null default 1,
    "runtime" text not null default 'server'::text,
    "handler" text not null default 'main'::text,
    "code" text not null,
    "inputs_schema" jsonb not null default '{}'::jsonb,
    "is_active" boolean not null default true,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now()
      );


alter table "public"."tool_code" enable row level security;


  create table "public"."tool_placements" (
    "id" uuid not null default gen_random_uuid(),
    "tool_id" text not null,
    "page_slug" text not null,
    "section_key" text not null default 'main'::text,
    "sort_order" integer not null default 0,
    "is_enabled" boolean not null default true,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now()
      );



  create table "public"."tool_runs" (
    "id" uuid not null default gen_random_uuid(),
    "tool_id" text not null,
    "code_version" integer not null,
    "runtime" text not null default 'server'::text,
    "input" jsonb not null,
    "ok" boolean not null,
    "output" jsonb,
    "error" text,
    "duration_ms" integer,
    "created_at" timestamp with time zone not null default now()
      );


alter table "public"."tool_runs" enable row level security;


  create table "public"."tools" (
    "id" text not null,
    "title" text not null,
    "description" text not null,
    "category" text not null,
    "href" text not null,
    "status" text not null default 'planned'::text,
    "compute_kind" text default 'client'::text,
    "inputs_schema" jsonb,
    "version" integer not null default 1,
    "is_featured" boolean default false,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now(),
    "slug" text,
    "is_active" boolean not null default true,
    "Code" text
      );


alter table "public"."tools" enable row level security;


  create table "public"."vehicle_categories" (
    "key" text not null,
    "label" text not null
      );



  create table "public"."vehicle_images11" (
    "id" uuid not null default gen_random_uuid(),
    "vehicle_id" uuid not null,
    "image_type" text not null,
    "bucket" text not null default 'vehicles1'::text,
    "object_key" text not null,
    "created_at" timestamp with time zone default now()
      );


alter table "public"."vehicle_images11" enable row level security;


  create table "public"."vehicle_pages111" (
    "id" uuid not null default gen_random_uuid(),
    "city_id" uuid not null,
    "vehicle_type" text not null,
    "slug" text not null,
    "hero_h1" text,
    "hero_subheading" text,
    "meta_title" text,
    "meta_description" text,
    "created_at" timestamp with time zone default now()
      );



  create table "public"."vehicles11" (
    "id" uuid not null default gen_random_uuid(),
    "name" text not null,
    "capacity" integer not null,
    "type" text,
    "amenities" text[] default '{}'::text[],
    "storage_path" text not null,
    "created_at" timestamp with time zone default now(),
    "city_id" uuid,
    "storage_path_2" text,
    "storage_path_3" text
      );


alter table "public"."vehicles11" enable row level security;


  create table "public"."vehicles_legacy" (
    "id" bigint generated by default as identity not null,
    "created_at" timestamp with time zone not null default now(),
    "vehicle_title" text,
    "short_description" text,
    "capacity" integer,
    "city" text,
    "zips" text,
    "custom_instructions" text,
    "categories" text,
    "category_slugs" text,
    "tags" text,
    "tag_slugs" text,
    "image_main" text,
    "image_2" text,
    "image_3" text,
    "gallery_all" text,
    "price_3hr" numeric,
    "price_4hr" numeric,
    "price_5hr" numeric,
    "price_6hr" numeric,
    "price_7hr" numeric,
    "price_8hr" numeric,
    "price_9hr" numeric,
    "price_10hr" numeric,
    "prom_price_6hr" numeric,
    "prom_price_7hr" numeric,
    "prom_price_8hr" numeric,
    "prom_price_9hr" numeric,
    "prom_price_10hr" numeric,
    "before5pm_3hr" numeric,
    "before5pm_4hr" numeric,
    "before5pm_5hr" numeric,
    "before5pm_6hr" numeric,
    "before5pm_7hr" numeric
      );


alter table "public"."vehicles_legacy" enable row level security;


  create table "public"."why_sections" (
    "id" bigint generated always as identity not null,
    "vehicle_type" text not null,
    "title" text not null,
    "points" jsonb not null default '[]'::jsonb,
    "order" integer,
    "intro" text default ''::text
      );


alter table "public"."why_sections" enable row level security;


  create table "tooling"."tool_code" (
    "id" bigint generated always as identity not null,
    "name" text not null,
    "description" text,
    "language" text not null,
    "code" text not null,
    "code_hash" text,
    "version" text,
    "code_ref" text,
    "enabled" boolean default false,
    "created_by" uuid,
    "created_at" timestamp with time zone default now(),
    "updated_at" timestamp with time zone default now(),
    "validation_status" text default 'pending'::text,
    "validation_message" text
      );


alter table "tooling"."tool_code" enable row level security;

alter table "public"."content_points" alter column "body" drop default;

alter table "public"."content_points" alter column "key" drop not null;

alter table "public"."content_points" alter column "metadata" drop default;

alter table "public"."events" add column "card_image" text;

alter table "public"."events" add column "hero_image" text;

alter table "public"."events" add column "images" jsonb default '[]'::jsonb;

alter table "public"."events" add column "is_active" boolean not null default true;

alter table "public"."events" add column "site_id" uuid not null default '0bad4d72-82be-442b-a8eb-f7e18b587e95'::uuid;

alter table "public"."events" add column "sort_order" integer not null default 100;

alter table "public"."events" add column "tags" text[] default '{}'::text[];

alter table "public"."events" add column "updated_at" timestamp with time zone default now();

alter table "public"."events" alter column "description" set not null;

alter sequence "public"."categories_id_seq" owned by "public"."categories1"."id";

alter sequence "public"."cities_id_seq" owned by "public"."cities"."id";

alter sequence "public"."faqs_id_seq" owned by "public"."faqs"."id";

alter sequence "public"."states_id_seq" owned by "public"."states"."id";

alter sequence "public"."tags_id_seq" owned by "public"."tags"."id";

CREATE UNIQUE INDEX amenities111_pkey ON public.amenities111 USING btree (id);

CREATE UNIQUE INDEX b2r_poll_options_pkey ON public.b2r_poll_options USING btree (id);

CREATE UNIQUE INDEX b2r_poll_options_poll_id_display_order_key ON public.b2r_poll_options USING btree (poll_id, display_order);

CREATE UNIQUE INDEX b2r_poll_votes_pkey ON public.b2r_poll_votes USING btree (id);

CREATE UNIQUE INDEX b2r_polls_pkey ON public.b2r_polls USING btree (id);

CREATE UNIQUE INDEX categories1_csv_backup_pkey ON public.categories1_csv_backup USING btree (slug);

CREATE UNIQUE INDEX categories1_csv_backup_slug_idx ON public.categories1_csv_backup USING btree (slug);

CREATE UNIQUE INDEX categories1_csv_pkey ON public.categories1_csv USING btree (slug);

CREATE UNIQUE INDEX categories_allowlist_pkey ON public.categories_allowlist USING btree (slug);

CREATE UNIQUE INDEX categories_name_key ON public.categories1 USING btree (name);

CREATE UNIQUE INDEX categories_pkey ON public.categories1 USING btree (id);

CREATE UNIQUE INDEX categories_slug_key ON public.categories1 USING btree (slug);

CREATE UNIQUE INDEX cities111_pkey ON public.cities111 USING btree (id);

CREATE UNIQUE INDEX cities111_slug_key ON public.cities111 USING btree (slug);

CREATE UNIQUE INDEX cities_pkey ON public.cities USING btree (id);

CREATE UNIQUE INDEX cities_slug_state_id_key ON public.cities USING btree (slug, state_id);

CREATE UNIQUE INDEX content_blocks111_city_id_vehicle_type_block_key_key ON public.content_blocks111 USING btree (city_id, vehicle_type, block_key);

CREATE UNIQUE INDEX content_blocks111_pkey ON public.content_blocks111 USING btree (id);

CREATE UNIQUE INDEX content_blocks_pkey ON public.content_blocks USING btree (id);

CREATE UNIQUE INDEX content_blocks_slug_key ON public.content_blocks USING btree (slug);

CREATE UNIQUE INDEX design_tokens_name_scope_theme_uidx ON public.design_tokens USING btree (name, scope, COALESCE(theme_id, '00000000-0000-0000-0000-000000000000'::uuid));

CREATE UNIQUE INDEX design_tokens_pkey ON public.design_tokens USING btree (id);

CREATE UNIQUE INDEX events_site_id_slug_key ON public.events USING btree (site_id, slug);

CREATE UNIQUE INDEX faqs_pkey ON public.faqs USING btree (id);

CREATE UNIQUE INDEX fleet_category_amenities_pkey ON public.fleet_category_amenities USING btree (category);

CREATE UNIQUE INDEX headers_page_slug_key ON public.headers USING btree (page_slug);

CREATE UNIQUE INDEX headers_pkey ON public.headers USING btree (id);

CREATE INDEX heroes1_archive_city_id_vehicle_type_page_slug_idx ON public.heroes1_archive USING btree (city_id, vehicle_type, page_slug);

CREATE UNIQUE INDEX heroes1_archive_page_slug_city_id_vehicle_type_idx ON public.heroes1_archive USING btree (page_slug, city_id, vehicle_type);

CREATE INDEX heroes1_archive_page_slug_idx ON public.heroes1_archive USING btree (page_slug);

CREATE UNIQUE INDEX heroes1_archive_pkey ON public.heroes1_archive USING btree (id);

CREATE UNIQUE INDEX heroes1_page_slug_city_vehicle_key ON public.heroes1 USING btree (page_slug, city_id, vehicle_type);

CREATE INDEX heroes1_page_slug_idx ON public.heroes1 USING btree (page_slug);

CREATE UNIQUE INDEX heroes1_page_slug_key ON public.heroes1 USING btree (page_slug);

CREATE UNIQUE INDEX heroes1_pkey ON public.heroes1 USING btree (id);

CREATE INDEX heroes1_variant_idx ON public.heroes1 USING btree (variant);

CREATE UNIQUE INDEX homepage_hero_pkey ON public.homepage_hero USING btree (id);

CREATE UNIQUE INDEX homepage_hero_slug_key ON public.homepage_hero USING btree (slug);

CREATE INDEX idx_amenities111_city_vehicle ON public.amenities111 USING btree (city_id, vehicle_type);

CREATE UNIQUE INDEX idx_amenities111_key_city ON public.amenities111 USING btree (key, city_id);

CREATE INDEX idx_faqs_page_slug ON public.faqs USING btree (page_slug);

CREATE INDEX idx_heroes1_city_vehicle ON public.heroes1 USING btree (city_id, vehicle_type, page_slug);

CREATE INDEX idx_images111_city_vehicle ON public.images111 USING btree (city_id, vehicle_type);

CREATE UNIQUE INDEX idx_images111_storage_path ON public.images111 USING btree (storage_path);

CREATE INDEX idx_option_poll_new ON public.poll_options_new USING btree (poll_id);

CREATE INDEX idx_poll_active_new ON public.polls_new USING btree (is_active);

CREATE INDEX idx_poll_categories1_parent_sort ON public.poll_categories1 USING btree (parent_slug, sort_order);

CREATE INDEX idx_poll_category_new ON public.polls_new USING btree (category);

CREATE INDEX idx_poll_options1_poll ON public.poll_options1 USING btree (poll_id);

CREATE INDEX idx_poll_options1_poll_id ON public.poll_options1 USING btree (poll_id);

CREATE INDEX idx_poll_votes1_option ON public.poll_votes1 USING btree (option_id);

CREATE INDEX idx_poll_votes1_poll ON public.poll_votes1 USING btree (poll_id);

CREATE INDEX idx_polls1_category ON public.polls1 USING btree (category_slug);

CREATE INDEX idx_polls1_category_slug ON public.polls1 USING btree (category_slug);

CREATE INDEX idx_reviews_city_state ON public.reviews USING btree (state_slug, city_slug);

CREATE INDEX idx_reviews_created ON public.reviews USING btree (created_at DESC);

CREATE INDEX idx_reviews_event ON public.reviews USING btree (event_slug);

CREATE UNIQUE INDEX idx_tools_id_unique ON public.tools USING btree (id);

CREATE UNIQUE INDEX idx_tools_slug ON public.tools USING btree (slug);

CREATE UNIQUE INDEX idx_tools_slug_unique ON public.tools USING btree (slug);

CREATE INDEX idx_vehicle_images11_vehicle_id ON public.vehicle_images11 USING btree (vehicle_id);

CREATE INDEX idx_vote_poll_new ON public.poll_votes_new USING btree (poll_id);

CREATE UNIQUE INDEX images111_pkey ON public.images111 USING btree (id);

CREATE UNIQUE INDEX ix_categories1_csv_slug ON public.categories1_csv USING btree (slug);

CREATE UNIQUE INDEX longform111_city_id_vehicle_type_slug_key ON public.longform111 USING btree (city_id, vehicle_type, slug);

CREATE UNIQUE INDEX longform111_pkey ON public.longform111 USING btree (id);

CREATE INDEX page_sections_idx ON public.page_sections USING btree (page_slug, is_active, "position");

CREATE UNIQUE INDEX page_sections_pkey ON public.page_sections USING btree (id);

CREATE UNIQUE INDEX pages_pkey ON public.pages USING btree (id);

CREATE UNIQUE INDEX pages_route_key ON public.pages USING btree (route);

CREATE UNIQUE INDEX poll_categories1_pkey ON public.poll_categories1 USING btree (id);

CREATE INDEX poll_categories1_slug_idx ON public.poll_categories1 USING btree (slug);

CREATE UNIQUE INDEX poll_categories1_slug_key ON public.poll_categories1 USING btree (slug);

CREATE UNIQUE INDEX poll_options1_pkey ON public.poll_options1 USING btree (id);

CREATE UNIQUE INDEX poll_options1_poll_id_label_key ON public.poll_options1 USING btree (poll_id, label);

CREATE UNIQUE INDEX poll_options1_poll_id_slug_key ON public.poll_options1 USING btree (poll_id, slug);

CREATE UNIQUE INDEX poll_options_new_pkey ON public.poll_options_new USING btree (id);

CREATE UNIQUE INDEX poll_options_pkey ON public.poll_options USING btree (poll_id, option_id);

CREATE UNIQUE INDEX poll_votes1_pkey ON public.poll_votes1 USING btree (id);

CREATE UNIQUE INDEX poll_votes1_poll_id_voter_key_key ON public.poll_votes1 USING btree (poll_id, voter_key);

CREATE UNIQUE INDEX poll_votes1_unique_vote ON public.poll_votes1 USING btree (poll_id, voter_token);

CREATE UNIQUE INDEX poll_votes_new_pkey ON public.poll_votes_new USING btree (id);

CREATE UNIQUE INDEX poll_votes_pkey ON public.poll_votes USING btree (poll_id, option_id);

CREATE INDEX polls1_backup_category_slug_idx ON public.polls1_backup USING btree (category_slug);

CREATE INDEX polls1_backup_category_slug_idx1 ON public.polls1_backup USING btree (category_slug);

CREATE UNIQUE INDEX polls1_backup_pkey ON public.polls1_backup USING btree (id);

CREATE UNIQUE INDEX polls1_backup_slug_key ON public.polls1_backup USING btree (slug);

CREATE INDEX polls1_cat_active_idx ON public.polls1 USING btree (category_slug, is_active);

CREATE UNIQUE INDEX polls1_pkey ON public.polls1 USING btree (id);

CREATE UNIQUE INDEX polls1_slug_key ON public.polls1 USING btree (slug);

CREATE UNIQUE INDEX polls1_slug_uidx ON public.polls1 USING btree (slug);

CREATE UNIQUE INDEX polls_new_pkey ON public.polls_new USING btree (id);

CREATE UNIQUE INDEX polls_new_slug_key ON public.polls_new USING btree (slug);

CREATE UNIQUE INDEX polls_pkey ON public.polls USING btree (id);

CREATE INDEX reviews_featured_idx ON public.reviews USING btree (featured, rating DESC);

CREATE UNIQUE INDEX reviews_hash_key ON public.reviews USING btree (hash);

CREATE UNIQUE INDEX reviews_pkey ON public.reviews USING btree (id);

CREATE INDEX reviews_published_idx ON public.reviews USING btree (COALESCE(published_at, created_at) DESC);

CREATE UNIQUE INDEX reviews_slug_key ON public.reviews USING btree (slug);

CREATE UNIQUE INDEX site_settings_pkey ON public.site_settings USING btree (key);

CREATE UNIQUE INDEX sites_pkey ON public.sites USING btree (id);

CREATE UNIQUE INDEX sites_slug_key ON public.sites USING btree (slug);

CREATE UNIQUE INDEX states_code_key ON public.states USING btree (code);

CREATE UNIQUE INDEX states_pkey ON public.states USING btree (id);

CREATE UNIQUE INDEX states_slug_key ON public.states USING btree (slug);

CREATE UNIQUE INDEX style_tokens_pkey ON public.style_tokens USING btree (id);

CREATE UNIQUE INDEX tags_name_key ON public.tags USING btree (name);

CREATE UNIQUE INDEX tags_pkey ON public.tags USING btree (id);

CREATE UNIQUE INDEX tags_slug_key ON public.tags USING btree (slug);

CREATE UNIQUE INDEX themes_key_key ON public.themes USING btree (key);

CREATE UNIQUE INDEX themes_pkey ON public.themes USING btree (id);

CREATE UNIQUE INDEX tool_code_pkey ON public.tool_code USING btree (tool_id, version);

CREATE UNIQUE INDEX tool_placements_pkey ON public.tool_placements USING btree (id);

CREATE UNIQUE INDEX tool_runs_pkey ON public.tool_runs USING btree (id);

CREATE UNIQUE INDEX tools_pkey ON public.tools USING btree (id);

CREATE INDEX tools_slug_idx ON public.tools USING btree (slug);

CREATE UNIQUE INDEX uq_tool_place ON public.tool_placements USING btree (page_slug, section_key, tool_id);

CREATE UNIQUE INDEX ux_poll_votes1_poll_voter ON public.poll_votes1 USING btree (poll_id, voter_key) WHERE (voter_key IS NOT NULL);

CREATE UNIQUE INDEX ux_style_tokens_all ON public.style_tokens USING btree (site_slug, page_slug, name);

CREATE UNIQUE INDEX ux_vehicles11_storage_path ON public.vehicles11 USING btree (storage_path);

CREATE UNIQUE INDEX vehicle_categories_pkey ON public.vehicle_categories USING btree (key);

CREATE UNIQUE INDEX vehicle_images11_pkey ON public.vehicle_images11 USING btree (id);

CREATE UNIQUE INDEX vehicle_images11_vehicle_id_image_type_key ON public.vehicle_images11 USING btree (vehicle_id, image_type);

CREATE UNIQUE INDEX vehicle_pages111_city_id_vehicle_type_key ON public.vehicle_pages111 USING btree (city_id, vehicle_type);

CREATE UNIQUE INDEX vehicle_pages111_pkey ON public.vehicle_pages111 USING btree (id);

CREATE UNIQUE INDEX vehicles11_pkey ON public.vehicles11 USING btree (id);

CREATE UNIQUE INDEX vehicles_pkey ON public.vehicles_legacy USING btree (id);

CREATE INDEX why_sections_order_idx ON public.why_sections USING btree ("order", id);

CREATE UNIQUE INDEX why_sections_pkey ON public.why_sections USING btree (id);

CREATE UNIQUE INDEX why_sections_vehicle_type_key ON public.why_sections USING btree (vehicle_type);

CREATE INDEX idx_tool_code_created_by ON tooling.tool_code USING btree (created_by);

CREATE INDEX idx_tool_code_name ON tooling.tool_code USING btree (name);

CREATE INDEX idx_tooling_tool_code_validation_status ON tooling.tool_code USING btree (validation_status);

CREATE UNIQUE INDEX tool_code_name_key ON tooling.tool_code USING btree (name);

CREATE UNIQUE INDEX tool_code_pkey ON tooling.tool_code USING btree (id);

alter table "public"."amenities111" add constraint "amenities111_pkey" PRIMARY KEY using index "amenities111_pkey";

alter table "public"."b2r_poll_options" add constraint "b2r_poll_options_pkey" PRIMARY KEY using index "b2r_poll_options_pkey";

alter table "public"."b2r_poll_votes" add constraint "b2r_poll_votes_pkey" PRIMARY KEY using index "b2r_poll_votes_pkey";

alter table "public"."b2r_polls" add constraint "b2r_polls_pkey" PRIMARY KEY using index "b2r_polls_pkey";

alter table "public"."categories1" add constraint "categories_pkey" PRIMARY KEY using index "categories_pkey";

alter table "public"."categories1_csv" add constraint "categories1_csv_pkey" PRIMARY KEY using index "categories1_csv_pkey";

alter table "public"."categories1_csv_backup" add constraint "categories1_csv_backup_pkey" PRIMARY KEY using index "categories1_csv_backup_pkey";

alter table "public"."categories_allowlist" add constraint "categories_allowlist_pkey" PRIMARY KEY using index "categories_allowlist_pkey";

alter table "public"."cities" add constraint "cities_pkey" PRIMARY KEY using index "cities_pkey";

alter table "public"."cities111" add constraint "cities111_pkey" PRIMARY KEY using index "cities111_pkey";

alter table "public"."content_blocks" add constraint "content_blocks_pkey" PRIMARY KEY using index "content_blocks_pkey";

alter table "public"."content_blocks111" add constraint "content_blocks111_pkey" PRIMARY KEY using index "content_blocks111_pkey";

alter table "public"."design_tokens" add constraint "design_tokens_pkey" PRIMARY KEY using index "design_tokens_pkey";

alter table "public"."faqs" add constraint "faqs_pkey" PRIMARY KEY using index "faqs_pkey";

alter table "public"."fleet_category_amenities" add constraint "fleet_category_amenities_pkey" PRIMARY KEY using index "fleet_category_amenities_pkey";

alter table "public"."headers" add constraint "headers_pkey" PRIMARY KEY using index "headers_pkey";

alter table "public"."heroes1" add constraint "heroes1_pkey" PRIMARY KEY using index "heroes1_pkey";

alter table "public"."heroes1_archive" add constraint "heroes1_archive_pkey" PRIMARY KEY using index "heroes1_archive_pkey";

alter table "public"."homepage_hero" add constraint "homepage_hero_pkey" PRIMARY KEY using index "homepage_hero_pkey";

alter table "public"."images111" add constraint "images111_pkey" PRIMARY KEY using index "images111_pkey";

alter table "public"."longform111" add constraint "longform111_pkey" PRIMARY KEY using index "longform111_pkey";

alter table "public"."page_sections" add constraint "page_sections_pkey" PRIMARY KEY using index "page_sections_pkey";

alter table "public"."pages" add constraint "pages_pkey" PRIMARY KEY using index "pages_pkey";

alter table "public"."poll_categories1" add constraint "poll_categories1_pkey" PRIMARY KEY using index "poll_categories1_pkey";

alter table "public"."poll_options" add constraint "poll_options_pkey" PRIMARY KEY using index "poll_options_pkey";

alter table "public"."poll_options1" add constraint "poll_options1_pkey" PRIMARY KEY using index "poll_options1_pkey";

alter table "public"."poll_options_new" add constraint "poll_options_new_pkey" PRIMARY KEY using index "poll_options_new_pkey";

alter table "public"."poll_votes" add constraint "poll_votes_pkey" PRIMARY KEY using index "poll_votes_pkey";

alter table "public"."poll_votes1" add constraint "poll_votes1_pkey" PRIMARY KEY using index "poll_votes1_pkey";

alter table "public"."poll_votes_new" add constraint "poll_votes_new_pkey" PRIMARY KEY using index "poll_votes_new_pkey";

alter table "public"."polls" add constraint "polls_pkey" PRIMARY KEY using index "polls_pkey";

alter table "public"."polls1" add constraint "polls1_pkey" PRIMARY KEY using index "polls1_pkey";

alter table "public"."polls1_backup" add constraint "polls1_backup_pkey" PRIMARY KEY using index "polls1_backup_pkey";

alter table "public"."polls_new" add constraint "polls_new_pkey" PRIMARY KEY using index "polls_new_pkey";

alter table "public"."reviews" add constraint "reviews_pkey" PRIMARY KEY using index "reviews_pkey";

alter table "public"."site_settings" add constraint "site_settings_pkey" PRIMARY KEY using index "site_settings_pkey";

alter table "public"."sites" add constraint "sites_pkey" PRIMARY KEY using index "sites_pkey";

alter table "public"."states" add constraint "states_pkey" PRIMARY KEY using index "states_pkey";

alter table "public"."style_tokens" add constraint "style_tokens_pkey" PRIMARY KEY using index "style_tokens_pkey";

alter table "public"."tags" add constraint "tags_pkey" PRIMARY KEY using index "tags_pkey";

alter table "public"."themes" add constraint "themes_pkey" PRIMARY KEY using index "themes_pkey";

alter table "public"."tool_code" add constraint "tool_code_pkey" PRIMARY KEY using index "tool_code_pkey";

alter table "public"."tool_placements" add constraint "tool_placements_pkey" PRIMARY KEY using index "tool_placements_pkey";

alter table "public"."tool_runs" add constraint "tool_runs_pkey" PRIMARY KEY using index "tool_runs_pkey";

alter table "public"."tools" add constraint "tools_pkey" PRIMARY KEY using index "tools_pkey";

alter table "public"."vehicle_categories" add constraint "vehicle_categories_pkey" PRIMARY KEY using index "vehicle_categories_pkey";

alter table "public"."vehicle_images11" add constraint "vehicle_images11_pkey" PRIMARY KEY using index "vehicle_images11_pkey";

alter table "public"."vehicle_pages111" add constraint "vehicle_pages111_pkey" PRIMARY KEY using index "vehicle_pages111_pkey";

alter table "public"."vehicles11" add constraint "vehicles11_pkey" PRIMARY KEY using index "vehicles11_pkey";

alter table "public"."vehicles_legacy" add constraint "vehicles_pkey" PRIMARY KEY using index "vehicles_pkey";

alter table "public"."why_sections" add constraint "why_sections_pkey" PRIMARY KEY using index "why_sections_pkey";

alter table "tooling"."tool_code" add constraint "tool_code_pkey" PRIMARY KEY using index "tool_code_pkey";

alter table "public"."amenities111" add constraint "amenities111_city_id_fkey" FOREIGN KEY (city_id) REFERENCES public.cities111(id) ON DELETE SET NULL not valid;

alter table "public"."amenities111" validate constraint "amenities111_city_id_fkey";

alter table "public"."b2r_poll_options" add constraint "b2r_poll_options_poll_id_display_order_key" UNIQUE using index "b2r_poll_options_poll_id_display_order_key";

alter table "public"."b2r_poll_options" add constraint "b2r_poll_options_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.b2r_polls(id) ON DELETE CASCADE not valid;

alter table "public"."b2r_poll_options" validate constraint "b2r_poll_options_poll_id_fkey";

alter table "public"."b2r_poll_votes" add constraint "b2r_poll_votes_option_id_fkey" FOREIGN KEY (option_id) REFERENCES public.b2r_poll_options(id) ON DELETE CASCADE not valid;

alter table "public"."b2r_poll_votes" validate constraint "b2r_poll_votes_option_id_fkey";

alter table "public"."b2r_poll_votes" add constraint "b2r_poll_votes_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.b2r_polls(id) ON DELETE CASCADE not valid;

alter table "public"."b2r_poll_votes" validate constraint "b2r_poll_votes_poll_id_fkey";

alter table "public"."categories1" add constraint "categories_name_key" UNIQUE using index "categories_name_key";

alter table "public"."categories1" add constraint "categories_slug_key" UNIQUE using index "categories_slug_key";

alter table "public"."cities" add constraint "cities_slug_state_id_key" UNIQUE using index "cities_slug_state_id_key";

alter table "public"."cities" add constraint "cities_state_id_fkey" FOREIGN KEY (state_id) REFERENCES public.states(id) ON DELETE CASCADE not valid;

alter table "public"."cities" validate constraint "cities_state_id_fkey";

alter table "public"."cities111" add constraint "cities111_slug_key" UNIQUE using index "cities111_slug_key";

alter table "public"."content_blocks" add constraint "content_blocks_slug_key" UNIQUE using index "content_blocks_slug_key";

alter table "public"."content_blocks" add constraint "content_blocks_status_check" CHECK ((status = ANY (ARRAY['draft'::text, 'published'::text]))) not valid;

alter table "public"."content_blocks" validate constraint "content_blocks_status_check";

alter table "public"."content_blocks111" add constraint "content_blocks111_city_id_fkey" FOREIGN KEY (city_id) REFERENCES public.cities111(id) ON DELETE CASCADE not valid;

alter table "public"."content_blocks111" validate constraint "content_blocks111_city_id_fkey";

alter table "public"."content_blocks111" add constraint "content_blocks111_city_id_vehicle_type_block_key_key" UNIQUE using index "content_blocks111_city_id_vehicle_type_block_key_key";

alter table "public"."events" add constraint "events_site_id_fkey" FOREIGN KEY (site_id) REFERENCES public.sites(id) ON DELETE CASCADE not valid;

alter table "public"."events" add constraint "events_site_id_slug_key" UNIQUE using index "events_site_id_slug_key";

alter table "public"."fleet_category_amenities" add constraint "fleet_category_amenities_category_check" CHECK ((category = ANY (ARRAY['party_buses'::text, 'limos'::text, 'coaches'::text]))) not valid;

alter table "public"."fleet_category_amenities" validate constraint "fleet_category_amenities_category_check";

alter table "public"."headers" add constraint "headers_page_slug_key" UNIQUE using index "headers_page_slug_key";

alter table "public"."homepage_hero" add constraint "homepage_hero_slug_key" UNIQUE using index "homepage_hero_slug_key";

alter table "public"."images111" add constraint "images111_city_id_fkey" FOREIGN KEY (city_id) REFERENCES public.cities111(id) ON DELETE SET NULL not valid;

alter table "public"."images111" validate constraint "images111_city_id_fkey";

alter table "public"."longform111" add constraint "longform111_city_id_fkey" FOREIGN KEY (city_id) REFERENCES public.cities111(id) ON DELETE CASCADE not valid;

alter table "public"."longform111" validate constraint "longform111_city_id_fkey";

alter table "public"."longform111" add constraint "longform111_city_id_vehicle_type_slug_key" UNIQUE using index "longform111_city_id_vehicle_type_slug_key";

alter table "public"."pages" add constraint "pages_route_key" UNIQUE using index "pages_route_key";

alter table "public"."pages" add constraint "pages_theme_key_fkey" FOREIGN KEY (theme_key) REFERENCES public.themes(key) not valid;

alter table "public"."pages" validate constraint "pages_theme_key_fkey";

alter table "public"."poll_categories1" add constraint "poll_categories1_parent_fk" FOREIGN KEY (parent_slug) REFERENCES public.poll_categories1(slug) ON DELETE SET NULL not valid;

alter table "public"."poll_categories1" validate constraint "poll_categories1_parent_fk";

alter table "public"."poll_categories1" add constraint "poll_categories1_slug_key" UNIQUE using index "poll_categories1_slug_key";

alter table "public"."poll_options" add constraint "poll_options_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.polls(id) not valid;

alter table "public"."poll_options" validate constraint "poll_options_poll_id_fkey";

alter table "public"."poll_options1" add constraint "poll_options1_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.polls1(id) ON DELETE CASCADE not valid;

alter table "public"."poll_options1" validate constraint "poll_options1_poll_id_fkey";

alter table "public"."poll_options1" add constraint "poll_options1_poll_id_label_key" UNIQUE using index "poll_options1_poll_id_label_key";

alter table "public"."poll_options1" add constraint "poll_options1_poll_id_slug_key" UNIQUE using index "poll_options1_poll_id_slug_key";

alter table "public"."poll_options_new" add constraint "poll_options_new_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.polls_new(id) ON DELETE CASCADE not valid;

alter table "public"."poll_options_new" validate constraint "poll_options_new_poll_id_fkey";

alter table "public"."poll_votes" add constraint "poll_votes_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.polls(id) not valid;

alter table "public"."poll_votes" validate constraint "poll_votes_poll_id_fkey";

alter table "public"."poll_votes1" add constraint "poll_votes1_option_id_fkey" FOREIGN KEY (option_id) REFERENCES public.poll_options1(id) ON DELETE CASCADE not valid;

alter table "public"."poll_votes1" validate constraint "poll_votes1_option_id_fkey";

alter table "public"."poll_votes1" add constraint "poll_votes1_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.polls1(id) ON DELETE CASCADE not valid;

alter table "public"."poll_votes1" validate constraint "poll_votes1_poll_id_fkey";

alter table "public"."poll_votes1" add constraint "poll_votes1_poll_id_voter_key_key" UNIQUE using index "poll_votes1_poll_id_voter_key_key";

alter table "public"."poll_votes_new" add constraint "poll_votes_new_option_id_fkey" FOREIGN KEY (option_id) REFERENCES public.poll_options_new(id) ON DELETE CASCADE not valid;

alter table "public"."poll_votes_new" validate constraint "poll_votes_new_option_id_fkey";

alter table "public"."poll_votes_new" add constraint "poll_votes_new_poll_id_fkey" FOREIGN KEY (poll_id) REFERENCES public.polls_new(id) ON DELETE CASCADE not valid;

alter table "public"."poll_votes_new" validate constraint "poll_votes_new_poll_id_fkey";

alter table "public"."polls1" add constraint "polls1_category_slug_fkey" FOREIGN KEY (category_slug) REFERENCES public.poll_categories1(slug) ON DELETE SET NULL not valid;

alter table "public"."polls1" validate constraint "polls1_category_slug_fkey";

alter table "public"."polls1" add constraint "polls1_slug_key" UNIQUE using index "polls1_slug_key";

alter table "public"."polls1_backup" add constraint "polls1_backup_slug_key" UNIQUE using index "polls1_backup_slug_key";

alter table "public"."polls_new" add constraint "polls_new_slug_key" UNIQUE using index "polls_new_slug_key";

alter table "public"."reviews" add constraint "reviews_hash_key" UNIQUE using index "reviews_hash_key";

alter table "public"."reviews" add constraint "reviews_rating_check" CHECK (((rating >= 1) AND (rating <= 5))) not valid;

alter table "public"."reviews" validate constraint "reviews_rating_check";

alter table "public"."reviews" add constraint "reviews_slug_key" UNIQUE using index "reviews_slug_key";

alter table "public"."reviews" add constraint "reviews_source_check" CHECK ((source = ANY (ARRAY['google'::text, 'facebook'::text, 'yelp'::text, 'manual'::text, 'import'::text, 'other'::text]))) not valid;

alter table "public"."reviews" validate constraint "reviews_source_check";

alter table "public"."reviews" add constraint "reviews_status_check" CHECK ((status = ANY (ARRAY['draft'::text, 'published'::text, 'hidden'::text]))) not valid;

alter table "public"."reviews" validate constraint "reviews_status_check";

alter table "public"."sites" add constraint "sites_slug_key" UNIQUE using index "sites_slug_key";

alter table "public"."states" add constraint "states_code_check" CHECK ((char_length(code) = 2)) not valid;

alter table "public"."states" validate constraint "states_code_check";

alter table "public"."states" add constraint "states_code_key" UNIQUE using index "states_code_key";

alter table "public"."states" add constraint "states_slug_key" UNIQUE using index "states_slug_key";

alter table "public"."style_tokens" add constraint "ux_style_tokens_all" UNIQUE using index "ux_style_tokens_all";

alter table "public"."tags" add constraint "tags_name_key" UNIQUE using index "tags_name_key";

alter table "public"."tags" add constraint "tags_slug_key" UNIQUE using index "tags_slug_key";

alter table "public"."themes" add constraint "themes_key_key" UNIQUE using index "themes_key_key";

alter table "public"."tool_code" add constraint "tool_code_tool_id_fkey" FOREIGN KEY (tool_id) REFERENCES public.tools(id) ON DELETE CASCADE not valid;

alter table "public"."tool_code" validate constraint "tool_code_tool_id_fkey";

alter table "public"."tool_placements" add constraint "tool_placements_tool_id_fkey" FOREIGN KEY (tool_id) REFERENCES public.tools(id) ON DELETE CASCADE not valid;

alter table "public"."tool_placements" validate constraint "tool_placements_tool_id_fkey";

alter table "public"."tool_runs" add constraint "tool_runs_tool_id_fkey" FOREIGN KEY (tool_id) REFERENCES public.tools(id) ON DELETE CASCADE not valid;

alter table "public"."tool_runs" validate constraint "tool_runs_tool_id_fkey";

alter table "public"."tools" add constraint "tools_compute_kind_check" CHECK ((compute_kind = ANY (ARRAY['client'::text, 'edge'::text, 'server'::text, 'external'::text]))) not valid;

alter table "public"."tools" validate constraint "tools_compute_kind_check";

alter table "public"."tools" add constraint "tools_status_check" CHECK ((status = ANY (ARRAY['planned'::text, 'beta'::text, 'live'::text, 'hidden'::text]))) not valid;

alter table "public"."tools" validate constraint "tools_status_check";

alter table "public"."vehicle_categories" add constraint "vehicle_categories_key_check" CHECK ((key = ANY (ARRAY['party-buses'::text, 'limousines'::text, 'coach-buses'::text]))) not valid;

alter table "public"."vehicle_categories" validate constraint "vehicle_categories_key_check";

alter table "public"."vehicle_images11" add constraint "vehicle_images11_image_type_check" CHECK ((image_type = ANY (ARRAY['interior'::text, 'exterior'::text]))) not valid;

alter table "public"."vehicle_images11" validate constraint "vehicle_images11_image_type_check";

alter table "public"."vehicle_images11" add constraint "vehicle_images11_vehicle_id_fkey" FOREIGN KEY (vehicle_id) REFERENCES public.vehicles11(id) ON DELETE CASCADE not valid;

alter table "public"."vehicle_images11" validate constraint "vehicle_images11_vehicle_id_fkey";

alter table "public"."vehicle_images11" add constraint "vehicle_images11_vehicle_id_image_type_key" UNIQUE using index "vehicle_images11_vehicle_id_image_type_key";

alter table "public"."vehicle_pages111" add constraint "vehicle_pages111_city_id_fkey" FOREIGN KEY (city_id) REFERENCES public.cities111(id) ON DELETE CASCADE not valid;

alter table "public"."vehicle_pages111" validate constraint "vehicle_pages111_city_id_fkey";

alter table "public"."vehicle_pages111" add constraint "vehicle_pages111_city_id_vehicle_type_key" UNIQUE using index "vehicle_pages111_city_id_vehicle_type_key";

alter table "public"."why_sections" add constraint "why_sections_vehicle_type_key" UNIQUE using index "why_sections_vehicle_type_key";

alter table "tooling"."tool_code" add constraint "tool_code_created_by_fkey" FOREIGN KEY (created_by) REFERENCES auth.users(id) not valid;

alter table "tooling"."tool_code" validate constraint "tool_code_created_by_fkey";

alter table "tooling"."tool_code" add constraint "tool_code_name_key" UNIQUE using index "tool_code_name_key";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public._locale_subjects_cities()
 RETURNS text[]
 LANGUAGE sql
 STABLE
AS $function$ select array[
  'popular vehicle type','typical group size','favorite pickup neighborhood','airport transfer demand',
  'late-night bookings','multi-stop routes','average trip length','music vibe',
  'photo stop preference','alcohol policy','budget comfort','lead time before event',
  'vehicle cleanliness','driver friendliness','on-time rate','privacy needs',
  'tech hookups','Wi-Fi need','USB charging','A/C performance','quiet ride'
]; $function$
;

CREATE OR REPLACE FUNCTION public._locale_subjects_states()
 RETURNS text[]
 LANGUAGE sql
 STABLE
AS $function$ select array[
  'popular vehicle type','typical group size','common booking window','late-night demand',
  'airport transfer demand','favorite photo spot','multi-stop routes','average trip length',
  'music vibe','alcohol policy','pickup precision','dropoff proximity','budget comfort',
  'vehicle cleanliness','driver friendliness','on-time rate','luxury preference',
  'privacy needs','tech hookups','Wi-Fi need','USB charging','A/C performance','quiet ride',
  'cancellation window','deposit size','tipping norm','discount type','referral rewards'
]; $function$
;

CREATE OR REPLACE FUNCTION public.add_vehicle_amenity11(p_vehicle_id uuid, p_key text)
 RETURNS void
 LANGUAGE sql
AS $function$
  insert into vehicle_amenities11 (vehicle_id, amenity_id)
  select p_vehicle_id, a.id
  from amenities11 a
  where a.key = p_key
  on conflict do nothing;
$function$
;

create or replace view "public"."b2r_poll_results" as  SELECT p.id AS poll_id,
    p.question,
    p.category,
    p.group_key,
    po.id AS option_id,
    po.option_text,
    count(pv.id) AS vote_count
   FROM ((public.b2r_polls p
     LEFT JOIN public.b2r_poll_options po ON ((p.id = po.poll_id)))
     LEFT JOIN public.b2r_poll_votes pv ON ((po.id = pv.option_id)))
  WHERE (p.is_active = true)
  GROUP BY p.id, p.question, p.category, p.group_key, po.id, po.option_text
  ORDER BY p.id, po.display_order;


create or replace view "public"."categories_view" as  SELECT lower(TRIM(BOTH FROM categories)) AS category_slug,
    initcap(regexp_replace(TRIM(BOTH FROM categories), '_'::text, ' '::text, 'g'::text)) AS category_name,
    count(*) AS vehicle_count
   FROM public.vehicles_legacy
  WHERE (COALESCE(categories, ''::text) <> ''::text)
  GROUP BY (lower(TRIM(BOTH FROM categories))), (initcap(regexp_replace(TRIM(BOTH FROM categories), '_'::text, ' '::text, 'g'::text)))
  ORDER BY (initcap(regexp_replace(TRIM(BOTH FROM categories), '_'::text, ' '::text, 'g'::text)));


CREATE OR REPLACE FUNCTION public.enforce_max4_options1()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
declare c int;
begin
  select count(*) into c from poll_options1 where poll_id = coalesce(new.poll_id, old.poll_id);
  if tg_op = 'INSERT' and c >= 4 then
    raise exception 'poll % already has 4 options', new.poll_id;
  end if;
  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.ensure_category(p_slug text, p_name text DEFAULT NULL::text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
begin
  insert into categories(name, slug)
  values (coalesce(p_name, initcap(replace(p_slug,'-',' '))), p_slug)
  on conflict (slug) do nothing;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.faq_hash(_scope text, _state text, _city text, _event text, _question text)
 RETURNS text
 LANGUAGE sql
 IMMUTABLE
AS $function$
  select encode(digest(
    coalesce(_scope,'')||'|'||coalesce(_state,'')||'|'||coalesce(_city,'')||'|'||
    coalesce(_event,'')||'|'||regexp_replace(coalesce(_question,''),'[\s]+',' ','g')
  ,'sha256'),'hex');
$function$
;

CREATE OR REPLACE FUNCTION public.fetch_faqs_v2(p_city_slug text DEFAULT NULL::text, p_state_slug text DEFAULT NULL::text, p_search text DEFAULT NULL::text, p_limit integer DEFAULT 50, p_offset integer DEFAULT 0)
 RETURNS TABLE(id uuid, slug text, scope text, city_slug text, state_slug text, category text, services text[], question text, answer text, tags text[], status text, hash text, created_at timestamp with time zone)
 LANGUAGE sql
 STABLE
AS $function$
  with base as (
    select *
    from public.faqs_public_v2
    where (p_city_slug  is null or city_slug  = p_city_slug)
      and (p_state_slug is null or state_slug = p_state_slug)
      and (
        p_search is null
        or question ilike '%'||p_search||'%'
        or answer   ilike '%'||p_search||'%'
        or category ilike '%'||p_search||'%'
      )
  )
  select
    id, slug, scope, city_slug, state_slug, category, services,
    question, answer, tags, status, hash, created_at
  from base
  order by
    case scope when 'city' then 1 when 'state' then 2 else 3 end,
    category, slug
  limit p_limit offset p_offset;
$function$
;

CREATE OR REPLACE FUNCTION public.fetch_hero1(p_page_slug text)
 RETURNS jsonb
 LANGUAGE sql
 STABLE
AS $function$
  select h.data
  from heroes1 h
  where h.page_slug = p_page_slug and h.is_active = true
  limit 1
$function$
;

CREATE OR REPLACE FUNCTION public.fetch_reviews(p_city_slug text DEFAULT NULL::text, p_state_slug text DEFAULT NULL::text, p_event_slug text DEFAULT NULL::text, p_limit integer DEFAULT 20, p_offset integer DEFAULT 0)
 RETURNS SETOF public.reviews_public
 LANGUAGE sql
AS $function$
  select * from reviews_public
  where (p_city_slug  is null or city_slug  = p_city_slug)
    and (p_state_slug is null or state_slug = p_state_slug)
    and (p_event_slug is null or event_slug = p_event_slug)
  order by coalesce(service_date::timestamptz, created_at) desc
  limit greatest(1,p_limit) offset greatest(0,p_offset);
$function$
;

CREATE OR REPLACE FUNCTION public.force_lower_slug()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  NEW.slug := lower(trim(NEW.slug));
  IF NEW.parent_slug IS NOT NULL THEN
    NEW.parent_slug := lower(trim(NEW.parent_slug));
  END IF;
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.generate_city_basics(p_city_slug text, p_state_slug text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  _city_name text;
begin
  -- Get city printable name (for nice titles)
  select c.name into _city_name
  from cities c join states s on s.id = c.state_id
  where c.slug = p_city_slug and s.slug = p_state_slug;

  if _city_name is null then
    raise exception 'City % / State % not found', p_city_slug, p_state_slug;
  end if;

  -- 1) Capacity poll (city-scoped)
  perform upsert_poll(
    p_title           => format('In %s, what capacity do you usually need?', _city_name),
    p_slug            => slugify(p_city_slug || '-' || p_state_slug || '-capacity-preference'),
    p_description     => 'Helps size the right vehicle.',
    p_option_labels   => array['10-14','15-20','21-28','29-40','41+'],
    p_scope           => 'city',
    p_state_slug      => p_state_slug,
    p_city_slug       => p_city_slug,
    p_category_slugs  => array['capacity-preferences','party-bus-polls','city-polls'],
    p_tag_slugs       => array['party-bus']
  );

  -- 2) Booking preference (city-scoped)
  perform upsert_poll(
    p_title           => format('%s bookings: whatâ€™s your preferred method?', _city_name),
    p_slug            => slugify(p_city_slug || '-' || p_state_slug || '-booking-method'),
    p_description     => 'Tell us how you like to book.',
    p_option_labels   => array['Text quote','Phone call','Email','Website form'],
    p_scope           => 'city',
    p_state_slug      => p_state_slug,
    p_city_slug       => p_city_slug,
    p_category_slugs  => array['booking-experience','city-polls'],
    p_tag_slugs       => array['corporate']
  );

  -- 3) Vehicle type interest (city-scoped)
  perform upsert_poll(
    p_title           => format('Most interesting vehicle type in %s?', _city_name),
    p_slug            => slugify(p_city_slug || '-' || p_state_slug || '-vehicle-type-interest'),
    p_description     => 'What are you most likely to rent?',
    p_option_labels   => array['Party Bus','Limo','Coach Bus','Shuttle'],
    p_scope           => 'city',
    p_state_slug      => p_state_slug,
    p_city_slug       => p_city_slug,
    p_category_slugs  => array['party-bus-polls','city-polls'],
    p_tag_slugs       => array['party-bus']
  );
end$function$
;

CREATE OR REPLACE FUNCTION public.generate_city_polls(p_city_slug text, p_state_slug text, n integer DEFAULT 50)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  _city_name  text;
  _state_name text;
  subjects text[] := _locale_subjects_cities();
  frames   text[] := array[
     'In %s, what''s your preference for %s?',
     '%s: what best fits for %s?',
     'Your take in %s on %s?',
     'Planning in %s: choose for %s',
     'Most common in %s for %s?'
  ];
  opts    text[] := options_for_locale();
  wanted  int := greatest(1, n);
  i int := 0;
  s text; f text;
  title text; pslug text;
  cat_state text; cat_city text;
begin
  select c.name, s.name
    into _city_name, _state_name
  from cities c join states s on s.id = c.state_id
  where c.slug = p_city_slug and s.slug = p_state_slug;

  if _city_name is null then
    raise exception 'City/State not found: % / %', p_city_slug, p_state_slug;
  end if;

  -- categories (your convention)
  cat_state := 'state-'||p_state_slug||'-polls';
  cat_city  := 'state-'||p_city_slug||'-polls';  -- as in your provided list
  perform ensure_category('city-polls', 'City Polls');
  perform ensure_category(cat_state, initcap(replace(p_state_slug,'-',' '))||' Polls');
  perform ensure_category(cat_city,  initcap(replace(p_city_slug,'-',' '))||' Polls');

  for s in select * from unnest(subjects) loop
    exit when i >= wanted;
    foreach f in array frames loop
      exit when i >= wanted;

      title := format(f, _city_name, s);
      pslug := slugify(p_state_slug || '-' || p_city_slug || '-' || s || '-' || f);

      perform upsert_poll(
        p_title          => title,
        p_slug           => pslug,
        p_description    => 'City poll (auto-generated question bank).',
        p_option_labels  => opts,
        p_scope          => 'city',
        p_state_slug     => p_state_slug,
        p_city_slug      => p_city_slug,
        p_category_slugs => array['city-polls', cat_state, cat_city]
      );
      i := i + 1;
    end loop;
  end loop;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.generate_city_polls_page(n_per_city integer DEFAULT 50, page_size integer DEFAULT 3, after_id bigint DEFAULT NULL::bigint)
 RETURNS TABLE(last_city_id bigint, processed_city_slug text, processed_state_slug text)
 LANGUAGE plpgsql
AS $function$
declare r record;
begin
  for r in
    select c.id, c.slug as city_slug, s.slug as state_slug
    from cities c join states s on s.id = c.state_id
    where (after_id is null or c.id > after_id)
    order by c.id
    limit page_size
  loop
    perform generate_city_polls(r.city_slug, r.state_slug, n_per_city);
    last_city_id := r.id;
    processed_city_slug := r.city_slug;
    processed_state_slug := r.state_slug;
    return next;
  end loop;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.generate_polls_for_all_categories(n integer DEFAULT 50)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare r record;
begin
  for r in select slug from categories loop
    perform generate_polls_for_category(r.slug, n);
  end loop;
end$function$
;

CREATE OR REPLACE FUNCTION public.generate_polls_for_categories_page(n_per_category integer DEFAULT 50, page_size integer DEFAULT 8, after_slug text DEFAULT NULL::text)
 RETURNS TABLE(processed_slug text)
 LANGUAGE plpgsql
AS $function$
declare r record;
begin
  for r in
    select slug
    from categories
    where (after_slug is null or slug > after_slug)
    order by slug
    limit page_size
  loop
    perform generate_polls_for_category_v2(r.slug, n_per_category);
    processed_slug := r.slug;
    return next;  -- emit progress row
  end loop;
end$function$
;

CREATE OR REPLACE FUNCTION public.generate_polls_for_category(cat_slug text, n integer DEFAULT 50)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  i int; cat_name text; opts text[]; title text; pslug text;
begin
  select name into cat_name from categories where slug = cat_slug;
  if cat_name is null then raise exception 'Category % not found', cat_slug; end if;

  opts := options_for_category(cat_slug);

  for i in 1..n loop
    title := format('%s â€¢ Question %s', cat_name, to_char(i,'FM00'));
    pslug := slugify(cat_slug || '-q-' || i::text);

    perform upsert_poll(
      p_title          => title,
      p_slug           => pslug,
      p_description    => format('Auto-generated poll for %s', cat_name),
      p_option_labels  => opts,
      p_scope          => 'global',
      p_category_slugs => array[cat_slug]
    );
  end loop;
end$function$
;

CREATE OR REPLACE FUNCTION public.generate_polls_for_category_v2(cat_slug text, n integer DEFAULT 50)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  fam text;
  base_name text;
  place_name text;
  subjects text[];
  frames   text[];
  opts     text[];
  wanted   int := greatest(1, n);
  i int := 0;
  s text; f text;
  title text; pslug text;
begin
  fam := case
     when cat_slug like 'vehicle-%' then 'vehicle'
     when cat_slug like 'event-%' then 'event'
     when cat_slug like 'transportation-%' then 'transport'
     when cat_slug like 'secret-%' then 'secret'
     when cat_slug like 'state-%' or cat_slug like 'city-%' then 'locale'
     else 'extra'
  end;

  base_name := initcap(replace(replace(cat_slug,'-polls',''),'-',' '));
  if fam='locale' then
     place_name := initcap(replace(replace(replace(cat_slug,'state-',''),'city-',''),'-polls',''));
  end if;

  -- SUBJECTS + FRAMES (short lists x short lists â†’ 50+ unique combos)
  if fam='vehicle' then
    subjects := array[
      'LED lighting','sound system','leather seating','dance pole','onboard restroom','USB charging',
      'coolers/ice','Wi-Fi','TV screens','privacy partition','karaoke','luggage space',
      'wraparound seating','Bluetooth reliability','A/C performance','window tint','headroom',
      'underbody lights','bar setup','table space','photo backdrop','exterior color','newer model year',
      'brand reputation','ride comfort','low road noise','suspension quality','step assist','accessibility ramp','seat belts'
    ];
    frames := array[
      'How important is %s?','Would you pay more for %s?','Deal-breaker if no %s?',
      'Prefer classic or premium for %s?','Which do you prefer for %s?'
    ];
  elsif fam='event' then
    subjects := array[
      'group size','hours of service','multiple stops','alcohol on board','music vibe','photo stops',
      'pickup precision','budget flexibility','vehicle type','distance to venue','late-night return',
      'shared cost per person','VIP entry coordination','parking distance','meet-and-greet signage',
      'luggage capacity','rain plan','timeline control','pre-party stop','after-party plan'
    ];
    frames := array[
      'For this event, what''s your preference on %s?','What''s the ideal %s?',
      'How important is %s?','What best matches your needs for %s?','Would you change plans based on %s?'
    ];
  elsif fam='transport' then
    subjects := array[
      'price vs quality','safety features','seat comfort','quiet ride','luxury feel','amenities included',
      'privacy','vehicle design','music control','food & drink policy','tech hookups','sustainability',
      'customer service','booking speed','deposit amount','cancellation window','surge pricing tolerance',
      'tip expectations','insurance coverage','driver background checks','GPS tracking','ETA accuracy',
      'cleaning fee policy','pet policy','accessibility needs'
    ];
    frames := array[
      'What''s your stance on %s?','Rank the importance of %s','Would you pay more for better %s?',
      'Your preference for %s?','What would you choose regarding %s?'
    ];
  elsif fam='secret' then
    subjects := array[
      'worst rental experience','best booking tip','vendor red flags','hidden fees','unexpected perks',
      'wishlist feature','myth vs reality','DIY planning mistakes','must-ask question before booking','deal-breaker policy'
    ];
    frames := array[
      'Quick take: %s','Share your view: %s','Which is truer for you: %s?',
      'What resonates more: %s?','Hot take on %s?'
    ];
  elsif fam='locale' then
    subjects := array[
      'popular vehicle type','typical group size','common booking window','top pickup neighborhood',
      'airport transfer demand','favorite photo spot','late-night demand','multi-stop routes',
      'average trip length','music vibe'
    ];
    frames := array[
      'In %s, what''s your preference for %s?','%s: what best fits for %s?',
      'Your take in %s on %s?','Planning in %s: choose for %s','Most common in %s for %s?'
    ];
  else
    subjects := array[
      'driver friendliness','on-time rate','vehicle cleanliness','response speed','insurance clarity',
      'deposit size','cancellation fairness','tipping norm','fleet age','security cameras',
      'wheelchair access','pet friendly','karaoke','alcohol policy','restroom availability',
      'smoking policy','out-of-town surcharge','discount type','referral rewards','extra stop policy'
    ];
    frames := array[
      'How important is %s?','Preferred approach to %s?','What do you expect for %s?',
      'Deal-breaker on %s?','Pick one for %s'
    ];
  end if;

  opts := options_for_category(cat_slug);

  -- Generate combinations deterministically until we have N
  for s in select * from unnest(subjects) loop
    exit when i >= wanted;
    foreach f in array frames loop
      exit when i >= wanted;

      if fam='locale' then
        title := format(f, place_name, s);
      else
        title := base_name || ': ' || format(f, s);
      end if;

      pslug := slugify(cat_slug || '-' || s || '-' || f);

      perform upsert_poll(
        p_title          => title,
        p_slug           => pslug,
        p_description    => 'Auto-generated from question bank.',
        p_option_labels  => opts,
        p_scope          => 'global',
        p_category_slugs => array[cat_slug]
      );
      i := i + 1;
    end loop;
  end loop;
end$function$
;

CREATE OR REPLACE FUNCTION public.generate_state_polls(p_state_slug text, n integer DEFAULT 50)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  _state_name text;
  subjects text[] := _locale_subjects_states();
  frames   text[] := array[
     'In %s, what''s your preference for %s?',
     '%s: what best fits for %s?',
     'Your take in %s on %s?',
     'Planning in %s: choose for %s',
     'Most common in %s for %s?'
  ];
  opts    text[] := options_for_locale();
  wanted  int := greatest(1, n);
  i int := 0;
  s text; f text;
  title text; pslug text; cat_state text;
begin
  select name into _state_name from states where slug = p_state_slug;
  if _state_name is null then
    raise exception 'State % not found', p_state_slug;
  end if;

  -- ensure categories exist
  cat_state := 'state-'||p_state_slug||'-polls';
  perform ensure_category('state-polls', 'State Polls');
  perform ensure_category(cat_state, initcap(replace(p_state_slug,'-',' '))||' Polls');

  -- generate N polls
  for s in select * from unnest(subjects) loop
    exit when i >= wanted;
    foreach f in array frames loop
      exit when i >= wanted;

      title := format(f, _state_name, s);
      pslug := slugify(p_state_slug || '-' || s || '-' || f);

      perform upsert_poll(
        p_title          => title,
        p_slug           => pslug,
        p_description    => 'State poll (auto-generated question bank).',
        p_option_labels  => opts,
        p_scope          => 'state',
        p_state_slug     => p_state_slug,
        p_category_slugs => array['state-polls', cat_state]
      );
      i := i + 1;
    end loop;
  end loop;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.generate_state_polls_page(n_per_state integer DEFAULT 50, page_size integer DEFAULT 5, after_code text DEFAULT NULL::text)
 RETURNS TABLE(processed_state_code text, processed_state_slug text)
 LANGUAGE plpgsql
AS $function$
declare r record;
begin
  for r in
    select code, slug
    from states
    where (after_code is null or code > after_code)
    order by code
    limit page_size
  loop
    perform generate_state_polls(r.slug, n_per_state);
    processed_state_code := r.code;
    processed_state_slug := r.slug;
    return next;
  end loop;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.get_content_progress()
 RETURNS TABLE(tbl_name text, row_count bigint, latest_created_at timestamp with time zone, latest_updated_at timestamp with time zone)
 LANGUAGE plpgsql
AS $function$
declare
  t text;
  sch text;
  nm  text;
  q   text;
  rc  bigint;
  lc  timestamptz;
  lu  timestamptz;
begin
  for t in
    select unnest(array[
      'public.pages',
      'public.blocks',
      'public.events',
      'public.tools',
      'public.polls',
      'public.faqs',
      'public.vehicles',
      'public.cities',
      'public.states',
      'public.sites'
    ])
  loop
    sch := split_part(t,'.',1);
    nm  := split_part(t,'.',2);

    -- qualify to avoid name collision
    if exists (
      select 1
      from information_schema.tables ist
      where ist.table_schema = sch
        and ist.table_name   = nm
    ) then
      q := format('select count(*), max(created_at), max(updated_at) from %I.%I', sch, nm);
      execute q into rc, lc, lu;

      tbl_name := t;
      row_count := rc;
      latest_created_at := lc;
      latest_updated_at := lu;
      return next;
    end if;
  end loop;
end $function$
;

CREATE OR REPLACE FUNCTION public.get_style(site text, page text)
 RETURNS jsonb
 LANGUAGE sql
 STABLE
AS $function$
with base(tokens) as (
  values (
    '{
      "colors":{"primary":"#1d4ed8","accent":"#22c55e","bg":"#ffffff","muted":"#6b7280"},
      "radius":{"sm":"0.25rem","md":"0.5rem","lg":"1rem","xl":"1.5rem"},
      "font":{"body":"Inter, ui-sans-serif, system-ui","heading":"Poppins, ui-sans-serif, system-ui"},
      "shadow":{"card":"0 10px 25px rgba(0,0,0,0.08)"},
      "spacing":{"section":"4rem"}
    }'::jsonb
  )
),
site_default as (
  select tokens from style_tokens
  where site_slug = site and page_slug = ''
  order by updated_at desc limit 1
),
page_override as (
  select tokens from style_tokens
  where site_slug = site and page_slug = page
  order by updated_at desc limit 1
)
select
  (select tokens from base)
  || coalesce((select tokens from site_default), '{}'::jsonb)
  || coalesce((select tokens from page_override), '{}'::jsonb)
$function$
;

CREATE OR REPLACE FUNCTION public.import_faqs(items jsonb)
 RETURNS integer
 LANGUAGE plpgsql
AS $function$
declare
  it   jsonb;
  n    int := 0;
  _hash text;
  _slug text;
begin
  for it in select * from jsonb_array_elements(items) loop
    _hash := faq_hash(it->>'scope', it->>'state_slug', it->>'city_slug', it->>'event_slug', it->>'question');
    _slug := coalesce(it->>'slug',
                      slugify((it->>'scope')||'-'||coalesce(it->>'city_slug','')||'-'||coalesce(it->>'state_slug','')||'-'||left(_hash,8)));

    insert into faqs(
      slug, scope, state_slug, city_slug, event_slug,
      category, services, question, answer, tags, status, hash
    )
    values (
      _slug,
      it->>'scope',
      nullif(it->>'state_slug',''),
      nullif(it->>'city_slug',''),
      nullif(it->>'event_slug',''),
      it->>'category',
      coalesce( (select array_agg(val) from jsonb_array_elements_text(coalesce(it->'services','[]'::jsonb)) as s(val)), '{}'::text[] ),
      it->>'question',
      it->>'answer',
      coalesce( (select array_agg(val) from jsonb_array_elements_text(coalesce(it->'tags','[]'::jsonb)) as t(val)), '{}'::text[] ),
      coalesce(it->>'status','published'),
      _hash
    )
    on conflict (hash) do update set
      category = excluded.category,
      services = excluded.services,
      answer   = excluded.answer,
      tags     = excluded.tags,
      status   = excluded.status;

    n := n + 1;
  end loop;
  return n;
end $function$
;

CREATE OR REPLACE FUNCTION public.import_reviews(items jsonb)
 RETURNS TABLE(review_id uuid, review_slug text)
 LANGUAGE plpgsql
AS $function$
declare
  it jsonb;
  _id uuid;
  _slug text;
  _hash text;
  _slug_base text;
begin
  for it in select * from jsonb_array_elements(items) loop
    _hash := review_hash(it->>'author_display', it->>'body', nullif(it->>'service_date','')::date);
    _slug_base := slugify(coalesce(it->>'author_display','review') || '-' || left(_hash,8));

    insert into reviews(
      slug, source, source_id, source_url,
      author_display, rating, body, event_slug,
      city_slug, state_slug, service_date, status, hash
    )
    values (
      _slug_base,
      coalesce(it->>'source','import'),
      nullif(it->>'source_id',''),
      nullif(it->>'source_url',''),
      it->>'author_display',
      nullif(it->>'rating','')::smallint,
      it->>'body',
      nullif(it->>'event_slug',''),
      nullif(it->>'city_slug',''),
      nullif(it->>'state_slug',''),
      nullif(it->>'service_date','')::date,
      coalesce(it->>'status','published'),
      _hash
    )
    on conflict (hash) do update set
      body   = excluded.body,
      rating = coalesce(excluded.rating, reviews.rating),
      status = excluded.status
    returning reviews.id, reviews.slug
    into _id, _slug;

    return query select _id, _slug;
  end loop;
end
$function$
;

CREATE OR REPLACE FUNCTION public.import_tools(items jsonb)
 RETURNS integer
 LANGUAGE plpgsql
AS $function$
declare it jsonb; n int := 0;
begin
  for it in select * from jsonb_array_elements(items) loop
    insert into tools(id,title,description,category,href,status)
    values (
      it->>'id',
      it->>'title',
      it->>'desc',
      it->>'category',
      it->>'href',
      'planned'
    )
    on conflict (id) do update set
      title       = excluded.title,
      description = excluded.description,
      category    = excluded.category,
      href        = excluded.href;
    n := n + 1;
  end loop;
  return n;
end $function$
;

CREATE OR REPLACE FUNCTION public.increment_poll_vote(p_poll_id text, p_option_id text)
 RETURNS jsonb
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
DECLARE
  v_result jsonb;
BEGIN
  -- Insert the poll if it doesn't exist
  INSERT INTO public.polls (id)
  VALUES (p_poll_id)
  ON CONFLICT (id) DO NOTHING;

  -- Insert the poll option if it doesn't exist
  INSERT INTO public.poll_options (poll_id, option_id)
  VALUES (p_poll_id, p_option_id)
  ON CONFLICT (poll_id, option_id) DO NOTHING;

  -- Insert or update the vote count
  INSERT INTO public.poll_votes (poll_id, option_id, count)
  VALUES (p_poll_id, p_option_id, 1)
  ON CONFLICT (poll_id, option_id)
  DO UPDATE SET count = poll_votes.count + 1;

  -- Get updated counts for all options in this poll
  SELECT jsonb_object_agg(option_id, count)
  INTO v_result
  FROM public.poll_votes
  WHERE poll_id = p_poll_id;

  RETURN v_result;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.materialize_city_faqs(p_city_slug text, p_state_slug text, p_city_name text, p_downtown_area text, p_buffer_minutes integer, p_major_venue text, p_pickup_street_or_lot text, p_nightlife_district text, p_airport_code text, p_city_nickname text, p_photo_spot_1 text, p_photo_spot_2 text, p_sensitive_area text, p_quiet_hours text, p_popular_venue text, p_loading_street text, p_weather_pattern text, p_weather_buffer integer, p_offpeak_days text, p_evening_peak text, p_status text DEFAULT 'published'::text)
 RETURNS integer
 LANGUAGE sql
AS $function$
with src as (
  -- Use the 10 template rows you imported (placeholders still present)
  select *
  from public.faqs
  where scope='city' and status in ('template','template-city') and city_slug='{{city_slug}}'
),
filled as (
  -- Fill placeholders into question/answer
  select
    'city'::text                                  as scope,
    p_city_slug                                   as city_slug,
    p_state_slug                                  as state_slug,
    category,
    services,
    /* QUESTION with replacements */
    replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(question,
      '{{city_name}}',            p_city_name),
      '{{downtown_area}}',        p_downtown_area),
      '{{buffer_minutes}}',       p_buffer_minutes::text),
      '{{major_venue}}',          p_major_venue),
      '{{pickup_street_or_lot}}', p_pickup_street_or_lot),
      '{{nightlife_district}}',   p_nightlife_district),
      '{{airport_code}}',         p_airport_code),
      '{{city_nickname}}',        p_city_nickname),
      '{{photo_spot_1}}',         p_photo_spot_1),
      '{{photo_spot_2}}',         p_photo_spot_2),
      '{{sensitive_area}}',       p_sensitive_area),
      '{{quiet_hours}}',          p_quiet_hours),
      '{{popular_venue}}',        p_popular_venue),
      '{{loading_street}}',       p_loading_street),
      '{{weather_pattern}}',      p_weather_pattern),
      '{{weather_buffer}}',       p_weather_buffer::text),
      '{{offpeak_days}}',         p_offpeak_days),
      '{{evening_peak}}',         p_evening_peak)        as q,
    /* ANSWER with replacements */
    replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(answer,
      '{{city_name}}',            p_city_name),
      '{{downtown_area}}',        p_downtown_area),
      '{{buffer_minutes}}',       p_buffer_minutes::text),
      '{{major_venue}}',          p_major_venue),
      '{{pickup_street_or_lot}}', p_pickup_street_or_lot),
      '{{nightlife_district}}',   p_nightlife_district),
      '{{airport_code}}',         p_airport_code),
      '{{city_nickname}}',        p_city_nickname),
      '{{photo_spot_1}}',         p_photo_spot_1),
      '{{photo_spot_2}}',         p_photo_spot_2),
      '{{sensitive_area}}',       p_sensitive_area),
      '{{quiet_hours}}',          p_quiet_hours),
      '{{popular_venue}}',        p_popular_venue),
      '{{loading_street}}',       p_loading_street),
      '{{weather_pattern}}',      p_weather_pattern),
      '{{weather_buffer}}',       p_weather_buffer::text),
      '{{offpeak_days}}',         p_offpeak_days),
      '{{evening_peak}}',         p_evening_peak)        as a,
    tags
  from src
),
expanded as (
  -- Build a deterministic UUID from the filled content
  select
    (
      substr(fp,1,8)||'-'||substr(fp,9,4)||'-'||substr(fp,13,4)||'-'||substr(fp,17,4)||'-'||substr(fp,21,12)
    )::uuid                                as id,
    'city'::text                           as scope,
    p_city_slug                            as city_slug,
    p_state_slug                           as state_slug,
    category,
    services,
    q                                      as question,
    a                                      as answer,
    tags,
    p_status                               as status
  from (
    select category, services, q, a, tags,
           md5(p_city_slug||'|'||p_state_slug||'|'||category||'|'||q||'|'||a) as fp
    from filled
  ) s
),
ins as (
  insert into public.faqs
    (id, scope, city_slug, state_slug, category, services, question, answer, tags, status)
  select * from expanded
  on conflict (id) do update
  set scope      = excluded.scope,
      city_slug  = excluded.city_slug,
      state_slug = excluded.state_slug,
      category   = excluded.category,
      services   = excluded.services,
      question   = excluded.question,
      answer     = excluded.answer,
      tags       = excluded.tags,
      status     = excluded.status
  returning 1
)
select count(*) from ins;
$function$
;

CREATE OR REPLACE FUNCTION public.materialize_city_faqs(p_city_slug text, p_state_slug text, p_city_name text, p_downtown_area text, p_buffer_minutes integer, p_major_venue text, p_pickup_street_or_lot text, p_nightlife_district text, p_airport_code text, p_city_nickname text, p_photo_spot_1 text, p_photo_spot_2 text, p_sensitive_area text, p_quiet_hours text, p_popular_venue text, p_loading_street text, p_weather_pattern text, p_weather_buffer integer, p_offpeak_days text, p_evening_peak text, p_status text DEFAULT 'published'::text, p_template_city_slug text DEFAULT '{{city_slug}}'::text)
 RETURNS integer
 LANGUAGE sql
AS $function$
with src as (
  select *
  from public.faqs
  where scope='city' and city_slug = p_template_city_slug
),
filled as (
  select
    category,
    services,
    tags,
    replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(question,
      '{{city_name}}',            p_city_name),
      '{{downtown_area}}',        p_downtown_area),
      '{{buffer_minutes}}',       p_buffer_minutes::text),
      '{{major_venue}}',          p_major_venue),
      '{{pickup_street_or_lot}}', p_pickup_street_or_lot),
      '{{nightlife_district}}',   p_nightlife_district),
      '{{airport_code}}',         p_airport_code),
      '{{city_nickname}}',        p_city_nickname),
      '{{photo_spot_1}}',         p_photo_spot_1),
      '{{photo_spot_2}}',         p_photo_spot_2),
      '{{sensitive_area}}',       p_sensitive_area),
      '{{quiet_hours}}',          p_quiet_hours),
      '{{popular_venue}}',        p_popular_venue),
      '{{loading_street}}',       p_loading_street),
      '{{weather_pattern}}',      p_weather_pattern),
      '{{weather_buffer}}',       p_weather_buffer::text),
      '{{offpeak_days}}',         p_offpeak_days),
      '{{evening_peak}}',         p_evening_peak) as q,
    replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(answer,
      '{{city_name}}',            p_city_name),
      '{{downtown_area}}',        p_downtown_area),
      '{{buffer_minutes}}',       p_buffer_minutes::text),
      '{{major_venue}}',          p_major_venue),
      '{{pickup_street_or_lot}}', p_pickup_street_or_lot),
      '{{nightlife_district}}',   p_nightlife_district),
      '{{airport_code}}',         p_airport_code),
      '{{city_nickname}}',        p_city_nickname),
      '{{photo_spot_1}}',         p_photo_spot_1),
      '{{photo_spot_2}}',         p_photo_spot_2),
      '{{sensitive_area}}',       p_sensitive_area),
      '{{quiet_hours}}',          p_quiet_hours),
      '{{popular_venue}}',        p_popular_venue),
      '{{loading_street}}',       p_loading_street),
      '{{weather_pattern}}',      p_weather_pattern),
      '{{weather_buffer}}',       p_weather_buffer::text),
      '{{offpeak_days}}',         p_offpeak_days),
      '{{evening_peak}}',         p_evening_peak) as a
  from src
),
expanded as (
  select
    /* deterministic id from city + content */
    (substr(fp,1,8)||'-'||substr(fp,9,4)||'-'||substr(fp,13,4)||'-'||substr(fp,17,4)||'-'||substr(fp,21,12))::uuid as id,
    /* readable unique slug */
    lower(
      'city-'||p_city_slug||'-'||
      regexp_replace(coalesce(category,'misc'), '[^a-z0-9]+','-','g')||'-'||
      substr(fp,1,8)
    ) as slug,
    'city'::text as scope,
    p_city_slug  as city_slug,
    p_state_slug as state_slug,
    category,
    services,
    q as question,
    a as answer,
    tags,
    p_status as status,
    lower(fp) as hash               -- << NEW: required non-null hash
  from (
    select category, services, q, a, tags,
           md5(p_city_slug||'|'||p_state_slug||'|'||category||'|'||q||'|'||a) as fp
    from filled
  ) s
),
ins as (
  insert into public.faqs
    (id, slug, scope, city_slug, state_slug, category, services, question, answer, tags, status, hash)
  select * from expanded
  on conflict (id) do update
    set slug       = excluded.slug,
        scope      = excluded.scope,
        city_slug  = excluded.city_slug,
        state_slug = excluded.state_slug,
        category   = excluded.category,
        services   = excluded.services,
        question   = excluded.question,
        answer     = excluded.answer,
        tags       = excluded.tags,
        status     = excluded.status,
        hash       = excluded.hash
  returning 1
)
select count(*) from ins;
$function$
;

CREATE OR REPLACE FUNCTION public.materialize_state_faqs(p_state_slug text, p_state_name text, p_state_major_event text, p_airport_list text, p_seasonal_condition text, p_convention_center_list text, p_popular_area_1 text, p_popular_area_2 text, p_popular_area_3 text, p_status text DEFAULT 'published'::text, p_template_state_slug text DEFAULT '{{state_slug}}'::text)
 RETURNS integer
 LANGUAGE sql
AS $function$
with src as (
  select *
  from public.faqs
  where scope='state' and state_slug = p_template_state_slug
),
filled as (
  select
    category, services, tags,
    replace(replace(replace(replace(replace(replace(replace(replace(replace(question,
      '{{state_name}}',             p_state_name),
      '{{state_major_event}}',      p_state_major_event),
      '{{airport_list}}',           p_airport_list),
      '{{seasonal_condition}}',     p_seasonal_condition),
      '{{convention_center_list}}', p_convention_center_list),
      '{{popular_area_1}}',         p_popular_area_1),
      '{{popular_area_2}}',         p_popular_area_2),
      '{{popular_area_3}}',         p_popular_area_3),
      '{{state_slug}}',             p_state_slug) as q,
    replace(replace(replace(replace(replace(replace(replace(replace(replace(answer,
      '{{state_name}}',             p_state_name),
      '{{state_major_event}}',      p_state_major_event),
      '{{airport_list}}',           p_airport_list),
      '{{seasonal_condition}}',     p_seasonal_condition),
      '{{convention_center_list}}', p_convention_center_list),
      '{{popular_area_1}}',         p_popular_area_1),
      '{{popular_area_2}}',         p_popular_area_2),
      '{{popular_area_3}}',         p_popular_area_3),
      '{{state_slug}}',             p_state_slug) as a
  from src
),
expanded as (
  select
    (substr(fp,1,8)||'-'||substr(fp,9,4)||'-'||substr(fp,13,4)||'-'||substr(fp,17,4)||'-'||substr(fp,21,12))::uuid as id,
    lower('state-'||p_state_slug||'-'||regexp_replace(coalesce(category,'misc'),'[^a-z0-9]+','-','g')||'-'||substr(fp,1,8)) as slug,
    'state'::text as scope,
    null::text as city_slug,
    p_state_slug as state_slug,
    category,
    services,
    q as question,
    a as answer,
    tags,
    p_status as status,
    lower(fp) as hash
  from (
    select category, services, q, a, tags,
           md5(p_state_slug||'|'||category||'|'||q||'|'||a) as fp
    from filled
  ) s
),
ins as (
  insert into public.faqs
    (id, slug, scope, city_slug, state_slug, category, services, question, answer, tags, status, hash)
  select * from expanded
  on conflict (id) do update
    set slug       = excluded.slug,
        scope      = excluded.scope,
        city_slug  = excluded.city_slug,
        state_slug = excluded.state_slug,
        category   = excluded.category,
        services   = excluded.services,
        question   = excluded.question,
        answer     = excluded.answer,
        tags       = excluded.tags,
        status     = excluded.status,
        hash       = excluded.hash
  returning 1
)
select count(*) from ins;
$function$
;

CREATE OR REPLACE FUNCTION public.options_for_category(cat_slug text)
 RETURNS text[]
 LANGUAGE sql
 STABLE
AS $function$
  select case
    -- families
    when cat_slug like 'vehicle-%'        then array['Love it','Like it','Neutral','Not for me']
    when cat_slug like 'event-%'          then array['Definitely','Probably','Maybe','No']
    when cat_slug like 'transportation-%' then array['Very important','Important','Nice to have','Not important']
    when cat_slug like 'secret-%'         then array['Yes','No','Depends','Spill the tea']
    when cat_slug like 'driver-%'         then array['Excellent','Good','Okay','Poor']
    when cat_slug like 'cleanliness-%'    then array['Spotless','Clean','Okay','Needs work']
    when cat_slug like 'timeliness-%'     then array['Always on time','Usually on time','Sometimes late','Often late']
    -- specific overrides
    when cat_slug = 'cancellation-policy-polls' then array['24 h','48 h','72 h','7 days']
    when cat_slug = 'deposit-polls'              then array['No deposit','< 10%','10â€“25%','25%+']
    when cat_slug = 'tipping-polls'              then array['10%','15%','20%','25%+']
    when cat_slug = 'alcohol-policy-polls'       then array['Allowed onboard','Only sealed','Not allowed','Only at stops']
    -- default
    else array['Option A','Option B','Option C','Option D']
  end;
$function$
;

CREATE OR REPLACE FUNCTION public.options_for_locale()
 RETURNS text[]
 LANGUAGE sql
 STABLE
AS $function$ select array['Very important','Important','Nice to have','Not important']; $function$
;

create or replace view "public"."poll_option_counts" as  SELECT o.poll_id,
    o.id AS option_id,
    count(v.id) AS votes
   FROM (public.poll_options1 o
     LEFT JOIN public.poll_votes1 v ON ((v.option_id = o.id)))
  GROUP BY o.poll_id, o.id;


create or replace view "public"."poll_totals" as  SELECT poll_id,
    sum(votes) AS total_votes
   FROM public.poll_option_counts
  GROUP BY poll_id;


CREATE OR REPLACE FUNCTION public.quote_vehicles_legacy(p_category_slug text, p_city text, p_passengers integer, p_hours integer, p_event_type text, p_event_date date, p_start_time time without time zone)
 RETURNS TABLE(vehicle_id bigint, vehicle_title text, categories text, capacity integer, city text, applied_hours integer, base_price numeric, total_price numeric, notes text)
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
declare
  is_saturday    boolean := extract(isodow from p_event_date) = 6;
  mon            int     := extract(month from p_event_date);
  is_prom_season boolean := mon between 3 and 5;
  evt            text    := coalesce(lower(p_event_type), '');
  is_prom        boolean := (is_prom_season and is_saturday)
                            or evt like '%prom%' or evt like '%dance%';
  before_5       boolean := p_start_time < time '17:00';
  need_hours     int     := greatest(1, p_hours);
  slug_target    text    := nullif(regexp_replace(lower(coalesce(p_category_slug,'')), '[^a-z0-9]+','-','g'),'');
  r record;
  base numeric;
  used_hours int;
  note text;
begin
  for r in
    select
      vl.id, vl.vehicle_title, vl.categories, vl.capacity, vl.city,
      vp.hours, vp.price_regular, vp.price_matinee, vp.price_prom
    from public.vehicles_legacy vl
    join public.vehicle_prices_from_legacy vp
      on vp.vehicle_id = vl.id
    where vl.capacity >= p_passengers
      and (p_city is null or lower(vl.city) = lower(p_city))
      and (
        slug_target is null
        or regexp_replace(lower(vl.categories), '[^a-z0-9]+','-','g') = slug_target
      )
    order by vl.id, vp.hours
  loop
    -- reset per candidate
    note := '';
    base := null;
    used_hours := need_hours;

    if is_prom then
      -- prefer explicit prom price
      select price_prom into base
      from public.vehicle_prices_from_legacy
      where vehicle_id = r.id and hours = need_hours;

      if base is null then
        used_hours := greatest(4, need_hours);
        select case when before_5 then vp.price_matinee else vp.price_regular end
        into base
        from public.vehicle_prices_from_legacy vp
        where vp.vehicle_id = r.id and vp.hours = used_hours;

        note := note || format('Prom fallback to %sh; ', used_hours);
      else
        note := note || 'Prom rate; ';
      end if;

    else
      -- matinee preferred if present
      select case when before_5 then vp.price_matinee else vp.price_regular end
      into base
      from public.vehicle_prices_from_legacy vp
      where vp.vehicle_id = r.id and vp.hours = need_hours;

      if base is null then
        -- bump to next available tier
        select case when before_5 then vp.price_matinee else vp.price_regular end
        into base
        from public.vehicle_prices_from_legacy vp
        where vp.vehicle_id = r.id and vp.hours >= need_hours
        order by vp.hours asc
        limit 1;

        if base is not null then
          select vp.hours into used_hours
          from public.vehicle_prices_from_legacy vp
          where vp.vehicle_id = r.id and vp.hours >= need_hours
          order by vp.hours asc
          limit 1;

          note := note || format('Bumped to %sh; ', used_hours);
        end if;
      end if;
    end if;

    if base is null then
      continue;
    end if;

    -- âœ… Use RETURN QUERY for RETURNS TABLE
    return query
      select r.id, r.vehicle_title, r.categories, r.capacity, r.city,
             used_hours, base, base, trim(both ' ' from note);
  end loop;
end $function$
;

CREATE OR REPLACE FUNCTION public.rate_review(p_id uuid, p_rating smallint)
 RETURNS void
 LANGUAGE sql
AS $function$
  update reviews set rating = p_rating where id = p_id;
$function$
;

CREATE OR REPLACE FUNCTION public.remove_vehicle_amenity11(p_vehicle_id uuid, p_key text)
 RETURNS void
 LANGUAGE sql
AS $function$
  delete from vehicle_amenities11 va
  using amenities11 a
  where va.vehicle_id = p_vehicle_id
    and va.amenity_id = a.id
    and a.key = p_key;
$function$
;

CREATE OR REPLACE FUNCTION public.review_hash(_author text, _body text, _date date)
 RETURNS text
 LANGUAGE sql
 IMMUTABLE
AS $function$
  select encode(digest(
    coalesce(_author,'') || '|' ||
    regexp_replace(coalesce(_body,''),'[\s]+',' ','g') || '|' ||
    coalesce(_date::text,'')
  ,'sha256'),'hex');
$function$
;

create or replace view "public"."reviews_public" as  SELECT id,
    slug,
    source,
    source_url,
    author_display,
    rating,
    body,
    event_slug,
    city_slug,
    state_slug,
    service_date,
    status,
    created_at
   FROM public.reviews
  WHERE (status = 'published'::text);


CREATE OR REPLACE FUNCTION public.set_tools_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin new.updated_at := now(); return new; end $function$
;

CREATE OR REPLACE FUNCTION public.set_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.updated_at := now();
  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.slugify(txt text)
 RETURNS text
 LANGUAGE sql
 IMMUTABLE
AS $function$
  select regexp_replace(
    lower(regexp_replace(unaccent(coalesce(txt,'')), '[^a-zA-Z0-9]+','-','g')),
    '(^-|-$)','', 'g'
  )
$function$
;

CREATE OR REPLACE FUNCTION public.slugify1(t text)
 RETURNS text
 LANGUAGE sql
 IMMUTABLE
AS $function$
  select regexp_replace(lower(trim(t)), '[^a-z0-9]+', '-', 'g');
$function$
;

create or replace view "public"."storage_vehicle_objects" as  SELECT b.name AS bucket,
    o.name AS object_path,
    o.id,
    o.created_at,
    o.updated_at,
    o.last_accessed_at,
    (o.metadata ->> 'mimetype'::text) AS mimetype,
    COALESCE(((o.metadata ->> 'size'::text))::bigint, (0)::bigint) AS size_bytes,
    ((('/storage/v1/object/public/'::text || b.name) || '/'::text) || o.name) AS public_url_path
   FROM (storage.objects o
     JOIN storage.buckets b ON ((b.id = o.bucket_id)))
  WHERE (b.name = 'vehicles'::text);


create or replace view "public"."storage_vehicle_prefix_rollup" as  WITH tokens AS (
         SELECT split_part(storage_vehicle_objects.object_path, '/'::text, 1) AS prefix,
            storage_vehicle_objects.size_bytes
           FROM public.storage_vehicle_objects
        )
 SELECT prefix,
    count(*) AS object_count,
    sum(size_bytes) AS total_bytes,
    (avg(NULLIF(size_bytes, 0)))::bigint AS avg_bytes
   FROM tokens
  GROUP BY prefix
  ORDER BY (count(*)) DESC;


CREATE OR REPLACE FUNCTION public.tg_tools_touch_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.updated_at := now();
  return new;
end$function$
;

CREATE OR REPLACE FUNCTION public.tg_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.updated_at = now();
  return new;
end $function$
;

CREATE OR REPLACE FUNCTION public.upsert_hero1(p_page_slug text, p_data jsonb)
 RETURNS jsonb
 LANGUAGE plpgsql
AS $function$
begin
  insert into heroes1 (page_slug, data, is_active)
  values (p_page_slug, p_data, coalesce((p_data->>'is_active')::boolean, true))
  on conflict (page_slug) do update
    set data = excluded.data,
        is_active = excluded.is_active,
        updated_at = now();
  return p_data;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.upsert_poll(p_title text, p_slug text, p_description text, p_option_labels text[], p_scope text DEFAULT 'global'::text, p_state_slug text DEFAULT NULL::text, p_city_slug text DEFAULT NULL::text, p_is_active boolean DEFAULT true, p_sort_priority integer DEFAULT 0, p_category_slugs text[] DEFAULT '{}'::text[], p_tag_slugs text[] DEFAULT '{}'::text[])
 RETURNS bigint
 LANGUAGE plpgsql
AS $function$
declare
  _poll_id  bigint;
  _state_id bigint;
  _city_id  bigint;
  lbl    text;
  idx    int := 0;
  cat    text;
  tag    text;
  cat_id bigint;
  tag_id bigint;
begin
  if p_state_slug is not null then
    select id into _state_id from states where slug = p_state_slug;
  end if;

  if p_city_slug is not null then
    select c.id into _city_id
    from cities c join states s on s.id = c.state_id
    where c.slug = p_city_slug and (p_state_slug is null or s.slug = p_state_slug);
  end if;

  insert into polls(title, slug, description, scope, state_id, city_id, is_active, sort_priority)
  values (p_title, p_slug, p_description, p_scope, _state_id, _city_id, coalesce(p_is_active,true), coalesce(p_sort_priority,0))
  on conflict(slug) do update
    set title        = excluded.title,
        description  = excluded.description,
        scope        = excluded.scope,
        state_id     = excluded.state_id,
        city_id      = excluded.city_id,
        is_active    = excluded.is_active,
        sort_priority= excluded.sort_priority,
        updated_at   = now()
  returning id into _poll_id;

  -- options
  delete from poll_options where poll_id = _poll_id;
  foreach lbl in array coalesce(p_option_labels, '{}') loop
    insert into poll_options(poll_id, label, value, sort_order)
    values (_poll_id, lbl, slugify(lbl), idx);
    idx := idx + 1;
  end loop;

  -- categories
  delete from poll_categories where poll_id = _poll_id;
  foreach cat in array coalesce(p_category_slugs,'{}') loop
    insert into categories(name, slug)
      values (initcap(replace(cat,'-',' ')), cat)
      on conflict(slug) do nothing
      returning id into cat_id;
    if cat_id is null then select id into cat_id from categories where slug = cat; end if;
    insert into poll_categories(poll_id, category_id) values (_poll_id, cat_id)
    on conflict do nothing;
  end loop;

  -- tags
  delete from poll_tags where poll_id = _poll_id;
  foreach tag in array coalesce(p_tag_slugs,'{}') loop
    insert into tags(name, slug)
      values (initcap(replace(tag,'-',' ')), tag)
      on conflict(slug) do nothing
      returning id into tag_id;
    if tag_id is null then select id into tag_id from tags where slug = tag; end if;
    insert into poll_tags(poll_id, tag_id) values (_poll_id, tag_id)
    on conflict do nothing;
  end loop;

  return _poll_id;
end$function$
;

CREATE OR REPLACE FUNCTION public.upsert_poll_with_options(_poll_slug text, _category_slug text, _question text, _multi_select boolean, _is_active boolean, _meta_json jsonb, _options jsonb)
 RETURNS uuid
 LANGUAGE plpgsql
AS $function$
DECLARE
  v_poll_id uuid;
BEGIN
  INSERT INTO polls1 (slug, category_slug, question, multi_select, is_active, meta_json)
  VALUES (lower(_poll_slug), lower(_category_slug), _question, _multi_select, _is_active, COALESCE(_meta_json, '{}'::jsonb))
  ON CONFLICT (slug)
  DO UPDATE SET
    category_slug = EXCLUDED.category_slug,
    question      = EXCLUDED.question,
    multi_select  = EXCLUDED.multi_select,
    is_active     = EXCLUDED.is_active,
    meta_json     = EXCLUDED.meta_json
  RETURNING id INTO v_poll_id;

  DELETE FROM poll_options1 WHERE poll_id = v_poll_id;

  -- Insert ONLY the first 4 options (by sort_order, then ord)
  INSERT INTO poll_options1 (poll_id, slug, value, label, sort_order)
  SELECT
    v_poll_id,
    lower(
      substr(
        regexp_replace(_poll_slug, '[^a-z0-9\-]+', '-', 'gi')
        || '-' ||
        regexp_replace(COALESCE(NULLIF(opt.obj->>'value',''), opt.obj->>'label', 'opt-'||opt.ord::text), '[^a-z0-9]+','-','gi')
        || '-' ||
        lpad(COALESCE(NULLIF(opt.obj->>'sort_order','')::int, (opt.ord::int)*10)::text, 3, '0'),
        1, 255
      )
    ) AS option_slug,
    lower(regexp_replace(COALESCE(NULLIF(opt.obj->>'value',''), opt.obj->>'label','opt-'||opt.ord::text), '[^a-z0-9]+','-','gi')) AS value,
    COALESCE(opt.obj->>'label', opt.obj->>'value', 'Option '||opt.ord::text) AS label,
    COALESCE(NULLIF(opt.obj->>'sort_order','')::int, (opt.ord::int)*10) AS sort_order
  FROM jsonb_array_elements(COALESCE(_options,'[]'::jsonb)) WITH ORDINALITY AS opt(obj, ord)
  ORDER BY COALESCE(NULLIF(opt.obj->>'sort_order','')::int, (opt.ord::int)*10), opt.ord
  LIMIT 4;

  RETURN v_poll_id;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.upsert_polls1_from_json(payload jsonb)
 RETURNS integer
 LANGUAGE plpgsql
AS $function$
declare
  p          jsonb;
  opt        jsonb;
  v_poll_id  uuid;         -- <<< UUID, not bigint
  v_cnt      int := 0;
begin
  -- Each element in the JSON array is one poll + options
  for p in
    select jsonb_array_elements(payload)
  loop
    -- Upsert the poll row and capture its UUID
    insert into public.polls1 (slug, category_slug, question, multi_select, is_active, meta, meta_json)
    values (
      p->>'slug',
      p->>'category_slug',
      p->>'question',
      coalesce((p->>'multi_select')::boolean, false),
      coalesce((p->>'is_active')::boolean, true),
      coalesce(p->'meta', '{}'::jsonb),
      coalesce(p->'meta', '{}'::jsonb)
    )
    on conflict (slug) do update set
      category_slug = excluded.category_slug,
      question      = excluded.question,
      multi_select  = excluded.multi_select,
      is_active     = excluded.is_active,
      meta          = excluded.meta,
      meta_json     = excluded.meta_json
    returning id into v_poll_id;

    -- Upsert options
    for opt in
      select jsonb_array_elements(coalesce(p->'options','[]'::jsonb))
    loop
      insert into public.poll_options1 (poll_id, slug, label, sort_order, value)
      values (
        v_poll_id,
        opt->>'slug',
        opt->>'label',
        coalesce((opt->>'sort_order')::int, 1),
        coalesce(opt->>'value', opt->>'label')
      )
      on conflict (poll_id, slug) do update set
        label      = excluded.label,
        sort_order = excluded.sort_order,
        value      = excluded.value;
    end loop;

    v_cnt := v_cnt + 1;
  end loop;

  return v_cnt;
end
$function$
;

create or replace view "public"."v_options_from_inline" as  SELECT NULL::text AS poll_id,
    NULL::text AS option_id,
    NULL::text AS label,
    NULL::text AS poll_slug
  WHERE false;


create or replace view "public"."v_options_from_table" as  SELECT (poll_id)::text AS poll_id,
    (id)::text AS option_id,
    label,
    NULL::text AS poll_slug
   FROM public.poll_options1
  WHERE ((label IS NOT NULL) AND (length(TRIM(BOTH FROM label)) > 0));


create or replace view "public"."v_options_public" as  SELECT id AS option_id,
    label AS option_label,
    (poll_id)::text AS poll_id_text,
    NULL::text AS poll_slug
   FROM public.poll_options1
  WHERE (poll_id IS NOT NULL);


create or replace view "public"."v_poll_options_label" as  SELECT id,
    poll_id,
    COALESCE((to_jsonb(o.*) ->> 'option_text'::text), (to_jsonb(o.*) ->> 'text'::text), (to_jsonb(o.*) ->> 'label'::text), (to_jsonb(o.*) ->> 'name'::text), (to_jsonb(o.*) ->> 'title'::text), (to_jsonb(o.*) ->> 'value'::text)) AS label,
    COALESCE((NULLIF((to_jsonb(o.*) ->> 'sort_order'::text), ''::text))::integer, (NULLIF((to_jsonb(o.*) ->> 'position'::text), ''::text))::integer, (NULLIF((to_jsonb(o.*) ->> 'order'::text), ''::text))::integer, (NULLIF((to_jsonb(o.*) ->> 'idx'::text), ''::text))::integer, 0) AS sort_order
   FROM public.poll_options1 o;


create or replace view "public"."v_poll_results" as  SELECT poll_id,
    option_id,
    count(*) AS votes
   FROM public.poll_votes1
  GROUP BY poll_id, option_id;


create or replace view "public"."v_poll_results_cast" as  SELECT poll_id,
    option_id,
    votes,
    (poll_id)::text AS poll_id_text,
    (option_id)::text AS option_id_text
   FROM public.v_poll_results;


create or replace view "public"."v_polls_home" as  SELECT id,
    slug,
    question
   FROM public.polls1;


create or replace view "public"."v_polls_options_flat" as  SELECT p.id AS poll_id,
    p.slug AS poll_slug,
    p.category_slug,
    p.question,
    p.multi_select,
    p.is_active,
    p.meta_json,
    o.id AS option_id,
    o.value AS option_value,
    o.label AS option_label,
    o.sort_order AS option_sort_order
   FROM ((public.polls1 p
     JOIN public.categories_allowlist k ON ((k.slug = p.category_slug)))
     LEFT JOIN public.poll_options1 o ON ((o.poll_id = p.id)))
  ORDER BY p.category_slug, p.id, o.sort_order, o.id;


create or replace view "public"."v_polls_preview" as  WITH opts AS (
         SELECT p.id,
            p.category_slug,
            p.slug AS poll_slug,
            p.question,
            row_number() OVER (PARTITION BY p.id ORDER BY o.sort_order, o.label) AS rn,
            o.label
           FROM (public.polls1 p
             JOIN public.poll_options1 o ON ((o.poll_id = p.id)))
        )
 SELECT category_slug,
    poll_slug,
    question,
    string_agg(((substr('ABCDEFGHIJKLMNOPQRSTUVWXYZ'::text, (rn)::integer, 1) || ') '::text) || label), ', '::text ORDER BY rn) AS options_pretty
   FROM opts
  GROUP BY category_slug, poll_slug, question;


create or replace view "public"."v_polls_with_joined_options" as  SELECT p.id AS poll_id,
    p.slug AS poll_slug,
    p.category_slug,
    p.question,
    p.multi_select,
    p.is_active,
    p.meta_json,
    COALESCE(string_agg(((o.label || '|'::text) || o.value), '; '::text ORDER BY o.sort_order, o.id), ''::text) AS options_joined
   FROM ((public.polls1 p
     JOIN public.categories_allowlist k ON ((k.slug = p.category_slug)))
     LEFT JOIN public.poll_options1 o ON ((o.poll_id = p.id)))
  GROUP BY p.id, p.slug, p.category_slug, p.question, p.multi_select, p.is_active, p.meta_json
  ORDER BY p.category_slug, p.id;


create or replace view "public"."v_tool_code_active" as  SELECT DISTINCT ON (tool_id) tool_id,
    version,
    runtime,
    handler,
    code,
    inputs_schema,
    is_active,
    updated_at
   FROM public.tool_code
  WHERE is_active
  ORDER BY tool_id, version DESC, updated_at DESC;


create or replace view "public"."v_tools_home" as  SELECT tool_id AS slug,
    initcap(replace(tool_id, '-'::text, ' '::text)) AS name
   FROM public.tool_code
  ORDER BY tool_id
 LIMIT 12;


create or replace view "public"."v_tools_status" as  SELECT t.id,
    t.title,
    t.status,
    t.category,
    t.href,
    c.version AS code_version,
    c.runtime AS code_runtime,
    c.handler AS code_handler,
    c.updated_at AS code_updated_at,
    (c.tool_id IS NOT NULL) AS has_code
   FROM (public.tools t
     LEFT JOIN public.v_tool_code_active c ON ((c.tool_id = t.id)));


create or replace view "public"."vehicle_prices_from_legacy" as  SELECT vl.id AS vehicle_id,
    h.h AS hours,
    (NULLIF(((row_to_json(vl.*))::jsonb ->> (('price_'::text || h.h) || 'hr'::text)), ''::text))::numeric AS price_regular,
    (NULLIF(((row_to_json(vl.*))::jsonb ->> (('price_matinee_'::text || h.h) || 'hr'::text)), ''::text))::numeric AS price_matinee,
    (NULLIF(((row_to_json(vl.*))::jsonb ->> (('price_prom_'::text || h.h) || 'hr'::text)), ''::text))::numeric AS price_prom
   FROM (public.vehicles_legacy vl
     CROSS JOIN generate_series(3, 10) h(h));


create or replace view "public"."vehicles11_with_images" as  SELECT v.id,
    v.name,
    v.capacity,
    v.type,
    v.amenities,
    v.storage_path,
    v.created_at,
    max(
        CASE
            WHEN (vi.image_type = 'interior'::text) THEN vi.object_key
            ELSE NULL::text
        END) AS interior_key,
    max(
        CASE
            WHEN (vi.image_type = 'exterior'::text) THEN vi.object_key
            ELSE NULL::text
        END) AS exterior_key
   FROM (public.vehicles11 v
     LEFT JOIN public.vehicle_images11 vi ON ((vi.vehicle_id = v.id)))
  GROUP BY v.id;


CREATE OR REPLACE FUNCTION public.vote_and_tallies(p_poll_id uuid, p_option_id uuid, p_voter_key text)
 RETURNS TABLE(option_id uuid, votes bigint, total bigint)
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
begin
  -- one vote per poll per voter; re-voting updates their choice
  insert into public.poll_votes1 (poll_id, option_id, voter_key)
  values (p_poll_id, p_option_id, p_voter_key)
  on conflict (poll_id, voter_key)
  do update set option_id = excluded.option_id, created_at = now();

  -- return fresh tallies (use cnt to avoid name clash with OUT param "votes")
  return query
  with c as (
    select o.id as option_id, count(v.id)::bigint as cnt
    from public.poll_options1 o
    left join public.poll_votes1 v on v.option_id = o.id
    where o.poll_id = p_poll_id
    group by o.id
  ),
  t as (
    select coalesce(sum(c.cnt), 0)::bigint as total from c
  )
  select c.option_id, c.cnt as votes, t.total
  from c cross join t
  order by c.option_id;
end;
$function$
;

CREATE OR REPLACE FUNCTION tooling.set_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.fetch_header(p_page_slug text)
 RETURNS public.headers
 LANGUAGE sql
 STABLE
AS $function$
  select *
  from public.headers
  where page_slug = p_page_slug
    and is_active = true
  limit 1
$function$
;

CREATE OR REPLACE FUNCTION public.get_events_slot(p_limit integer DEFAULT 6, p_guarantee text[] DEFAULT ARRAY[]::text[])
 RETURNS TABLE(id uuid, name text, slug text, description text, href text, priority integer, weight integer, created_at timestamp with time zone)
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
DECLARE
  guaranteed_ids uuid[];
  needed integer;
BEGIN
  IF array_length(p_guarantee, 1) IS NOT NULL AND array_length(p_guarantee,1) > 0 THEN
    -- return guaranteed rows first (ordered by priority)
    RETURN QUERY
      SELECT e.id, e.name, e.slug, e.description, e.href, e.priority, e.weight, e.created_at
      FROM public.events e
      WHERE e.slug = ANY(p_guarantee)
      ORDER BY e.priority DESC
      LIMIT p_limit;

    -- qualify table alias to avoid ambiguous reference to the OUT-column named "id"
    guaranteed_ids := ARRAY(
      SELECT e2.id
      FROM public.events e2
      WHERE e2.slug = ANY(p_guarantee)
      ORDER BY e2.priority DESC
      LIMIT p_limit
    );
  ELSE
    guaranteed_ids := ARRAY[]::uuid[];
  END IF;

  needed := p_limit - COALESCE(array_length(guaranteed_ids,1), 0);
  IF needed <= 0 THEN
    RETURN;
  END IF;

  -- fill remaining slots with random selection excluding guaranteed ids
  RETURN QUERY
    SELECT e.id, e.name, e.slug, e.description, e.href, e.priority, e.weight, e.created_at
    FROM public.events e
    WHERE (COALESCE(array_length(guaranteed_ids,1),0) = 0 OR e.id <> ALL(guaranteed_ids))
    ORDER BY random()
    LIMIT needed;
END;
$function$
;

create materialized view "public"."mv_polls_options_flat" as  SELECT poll_id,
    poll_slug,
    category_slug,
    question,
    multi_select,
    is_active,
    meta_json,
    option_id,
    option_value,
    option_label,
    option_sort_order
   FROM public.v_polls_options_flat;


create or replace view "public"."review_stats" as  SELECT state_slug,
    city_slug,
    event_slug,
    count(*) AS review_count,
    (avg(rating))::numeric(3,2) AS avg_rating
   FROM public.reviews_public
  GROUP BY ROLLUP(state_slug, city_slug, event_slug);


CREATE INDEX idx_mv_flat_category ON public.mv_polls_options_flat USING btree (category_slug);

CREATE INDEX idx_mv_flat_poll ON public.mv_polls_options_flat USING btree (poll_id);

CREATE UNIQUE INDEX mv_polls_options_flat_uidx ON public.mv_polls_options_flat USING btree (poll_id, option_id);

grant delete on table "public"."amenities111" to "anon";

grant insert on table "public"."amenities111" to "anon";

grant references on table "public"."amenities111" to "anon";

grant select on table "public"."amenities111" to "anon";

grant trigger on table "public"."amenities111" to "anon";

grant truncate on table "public"."amenities111" to "anon";

grant update on table "public"."amenities111" to "anon";

grant delete on table "public"."amenities111" to "authenticated";

grant insert on table "public"."amenities111" to "authenticated";

grant references on table "public"."amenities111" to "authenticated";

grant select on table "public"."amenities111" to "authenticated";

grant trigger on table "public"."amenities111" to "authenticated";

grant truncate on table "public"."amenities111" to "authenticated";

grant update on table "public"."amenities111" to "authenticated";

grant delete on table "public"."amenities111" to "service_role";

grant insert on table "public"."amenities111" to "service_role";

grant references on table "public"."amenities111" to "service_role";

grant select on table "public"."amenities111" to "service_role";

grant trigger on table "public"."amenities111" to "service_role";

grant truncate on table "public"."amenities111" to "service_role";

grant update on table "public"."amenities111" to "service_role";

grant delete on table "public"."b2r_poll_options" to "anon";

grant insert on table "public"."b2r_poll_options" to "anon";

grant references on table "public"."b2r_poll_options" to "anon";

grant select on table "public"."b2r_poll_options" to "anon";

grant trigger on table "public"."b2r_poll_options" to "anon";

grant truncate on table "public"."b2r_poll_options" to "anon";

grant update on table "public"."b2r_poll_options" to "anon";

grant delete on table "public"."b2r_poll_options" to "authenticated";

grant insert on table "public"."b2r_poll_options" to "authenticated";

grant references on table "public"."b2r_poll_options" to "authenticated";

grant select on table "public"."b2r_poll_options" to "authenticated";

grant trigger on table "public"."b2r_poll_options" to "authenticated";

grant truncate on table "public"."b2r_poll_options" to "authenticated";

grant update on table "public"."b2r_poll_options" to "authenticated";

grant delete on table "public"."b2r_poll_options" to "service_role";

grant insert on table "public"."b2r_poll_options" to "service_role";

grant references on table "public"."b2r_poll_options" to "service_role";

grant select on table "public"."b2r_poll_options" to "service_role";

grant trigger on table "public"."b2r_poll_options" to "service_role";

grant truncate on table "public"."b2r_poll_options" to "service_role";

grant update on table "public"."b2r_poll_options" to "service_role";

grant delete on table "public"."b2r_poll_votes" to "anon";

grant insert on table "public"."b2r_poll_votes" to "anon";

grant references on table "public"."b2r_poll_votes" to "anon";

grant select on table "public"."b2r_poll_votes" to "anon";

grant trigger on table "public"."b2r_poll_votes" to "anon";

grant truncate on table "public"."b2r_poll_votes" to "anon";

grant update on table "public"."b2r_poll_votes" to "anon";

grant delete on table "public"."b2r_poll_votes" to "authenticated";

grant insert on table "public"."b2r_poll_votes" to "authenticated";

grant references on table "public"."b2r_poll_votes" to "authenticated";

grant select on table "public"."b2r_poll_votes" to "authenticated";

grant trigger on table "public"."b2r_poll_votes" to "authenticated";

grant truncate on table "public"."b2r_poll_votes" to "authenticated";

grant update on table "public"."b2r_poll_votes" to "authenticated";

grant delete on table "public"."b2r_poll_votes" to "service_role";

grant insert on table "public"."b2r_poll_votes" to "service_role";

grant references on table "public"."b2r_poll_votes" to "service_role";

grant select on table "public"."b2r_poll_votes" to "service_role";

grant trigger on table "public"."b2r_poll_votes" to "service_role";

grant truncate on table "public"."b2r_poll_votes" to "service_role";

grant update on table "public"."b2r_poll_votes" to "service_role";

grant delete on table "public"."b2r_polls" to "anon";

grant insert on table "public"."b2r_polls" to "anon";

grant references on table "public"."b2r_polls" to "anon";

grant select on table "public"."b2r_polls" to "anon";

grant trigger on table "public"."b2r_polls" to "anon";

grant truncate on table "public"."b2r_polls" to "anon";

grant update on table "public"."b2r_polls" to "anon";

grant delete on table "public"."b2r_polls" to "authenticated";

grant insert on table "public"."b2r_polls" to "authenticated";

grant references on table "public"."b2r_polls" to "authenticated";

grant select on table "public"."b2r_polls" to "authenticated";

grant trigger on table "public"."b2r_polls" to "authenticated";

grant truncate on table "public"."b2r_polls" to "authenticated";

grant update on table "public"."b2r_polls" to "authenticated";

grant delete on table "public"."b2r_polls" to "service_role";

grant insert on table "public"."b2r_polls" to "service_role";

grant references on table "public"."b2r_polls" to "service_role";

grant select on table "public"."b2r_polls" to "service_role";

grant trigger on table "public"."b2r_polls" to "service_role";

grant truncate on table "public"."b2r_polls" to "service_role";

grant update on table "public"."b2r_polls" to "service_role";

grant delete on table "public"."categories1" to "anon";

grant insert on table "public"."categories1" to "anon";

grant references on table "public"."categories1" to "anon";

grant select on table "public"."categories1" to "anon";

grant trigger on table "public"."categories1" to "anon";

grant truncate on table "public"."categories1" to "anon";

grant update on table "public"."categories1" to "anon";

grant delete on table "public"."categories1" to "authenticated";

grant insert on table "public"."categories1" to "authenticated";

grant references on table "public"."categories1" to "authenticated";

grant select on table "public"."categories1" to "authenticated";

grant trigger on table "public"."categories1" to "authenticated";

grant truncate on table "public"."categories1" to "authenticated";

grant update on table "public"."categories1" to "authenticated";

grant delete on table "public"."categories1" to "service_role";

grant insert on table "public"."categories1" to "service_role";

grant references on table "public"."categories1" to "service_role";

grant select on table "public"."categories1" to "service_role";

grant trigger on table "public"."categories1" to "service_role";

grant truncate on table "public"."categories1" to "service_role";

grant update on table "public"."categories1" to "service_role";

grant delete on table "public"."categories1_csv" to "anon";

grant insert on table "public"."categories1_csv" to "anon";

grant references on table "public"."categories1_csv" to "anon";

grant select on table "public"."categories1_csv" to "anon";

grant trigger on table "public"."categories1_csv" to "anon";

grant truncate on table "public"."categories1_csv" to "anon";

grant update on table "public"."categories1_csv" to "anon";

grant delete on table "public"."categories1_csv" to "authenticated";

grant insert on table "public"."categories1_csv" to "authenticated";

grant references on table "public"."categories1_csv" to "authenticated";

grant select on table "public"."categories1_csv" to "authenticated";

grant trigger on table "public"."categories1_csv" to "authenticated";

grant truncate on table "public"."categories1_csv" to "authenticated";

grant update on table "public"."categories1_csv" to "authenticated";

grant delete on table "public"."categories1_csv" to "service_role";

grant insert on table "public"."categories1_csv" to "service_role";

grant references on table "public"."categories1_csv" to "service_role";

grant select on table "public"."categories1_csv" to "service_role";

grant trigger on table "public"."categories1_csv" to "service_role";

grant truncate on table "public"."categories1_csv" to "service_role";

grant update on table "public"."categories1_csv" to "service_role";

grant delete on table "public"."categories1_csv_backup" to "anon";

grant insert on table "public"."categories1_csv_backup" to "anon";

grant references on table "public"."categories1_csv_backup" to "anon";

grant select on table "public"."categories1_csv_backup" to "anon";

grant trigger on table "public"."categories1_csv_backup" to "anon";

grant truncate on table "public"."categories1_csv_backup" to "anon";

grant update on table "public"."categories1_csv_backup" to "anon";

grant delete on table "public"."categories1_csv_backup" to "authenticated";

grant insert on table "public"."categories1_csv_backup" to "authenticated";

grant references on table "public"."categories1_csv_backup" to "authenticated";

grant select on table "public"."categories1_csv_backup" to "authenticated";

grant trigger on table "public"."categories1_csv_backup" to "authenticated";

grant truncate on table "public"."categories1_csv_backup" to "authenticated";

grant update on table "public"."categories1_csv_backup" to "authenticated";

grant delete on table "public"."categories1_csv_backup" to "service_role";

grant insert on table "public"."categories1_csv_backup" to "service_role";

grant references on table "public"."categories1_csv_backup" to "service_role";

grant select on table "public"."categories1_csv_backup" to "service_role";

grant trigger on table "public"."categories1_csv_backup" to "service_role";

grant truncate on table "public"."categories1_csv_backup" to "service_role";

grant update on table "public"."categories1_csv_backup" to "service_role";

grant delete on table "public"."categories_allowlist" to "anon";

grant insert on table "public"."categories_allowlist" to "anon";

grant references on table "public"."categories_allowlist" to "anon";

grant select on table "public"."categories_allowlist" to "anon";

grant trigger on table "public"."categories_allowlist" to "anon";

grant truncate on table "public"."categories_allowlist" to "anon";

grant update on table "public"."categories_allowlist" to "anon";

grant delete on table "public"."categories_allowlist" to "authenticated";

grant insert on table "public"."categories_allowlist" to "authenticated";

grant references on table "public"."categories_allowlist" to "authenticated";

grant select on table "public"."categories_allowlist" to "authenticated";

grant trigger on table "public"."categories_allowlist" to "authenticated";

grant truncate on table "public"."categories_allowlist" to "authenticated";

grant update on table "public"."categories_allowlist" to "authenticated";

grant delete on table "public"."categories_allowlist" to "service_role";

grant insert on table "public"."categories_allowlist" to "service_role";

grant references on table "public"."categories_allowlist" to "service_role";

grant select on table "public"."categories_allowlist" to "service_role";

grant trigger on table "public"."categories_allowlist" to "service_role";

grant truncate on table "public"."categories_allowlist" to "service_role";

grant update on table "public"."categories_allowlist" to "service_role";

grant delete on table "public"."cities" to "anon";

grant insert on table "public"."cities" to "anon";

grant references on table "public"."cities" to "anon";

grant select on table "public"."cities" to "anon";

grant trigger on table "public"."cities" to "anon";

grant truncate on table "public"."cities" to "anon";

grant update on table "public"."cities" to "anon";

grant delete on table "public"."cities" to "authenticated";

grant insert on table "public"."cities" to "authenticated";

grant references on table "public"."cities" to "authenticated";

grant select on table "public"."cities" to "authenticated";

grant trigger on table "public"."cities" to "authenticated";

grant truncate on table "public"."cities" to "authenticated";

grant update on table "public"."cities" to "authenticated";

grant delete on table "public"."cities" to "service_role";

grant insert on table "public"."cities" to "service_role";

grant references on table "public"."cities" to "service_role";

grant select on table "public"."cities" to "service_role";

grant trigger on table "public"."cities" to "service_role";

grant truncate on table "public"."cities" to "service_role";

grant update on table "public"."cities" to "service_role";

grant delete on table "public"."cities111" to "anon";

grant insert on table "public"."cities111" to "anon";

grant references on table "public"."cities111" to "anon";

grant select on table "public"."cities111" to "anon";

grant trigger on table "public"."cities111" to "anon";

grant truncate on table "public"."cities111" to "anon";

grant update on table "public"."cities111" to "anon";

grant delete on table "public"."cities111" to "authenticated";

grant insert on table "public"."cities111" to "authenticated";

grant references on table "public"."cities111" to "authenticated";

grant select on table "public"."cities111" to "authenticated";

grant trigger on table "public"."cities111" to "authenticated";

grant truncate on table "public"."cities111" to "authenticated";

grant update on table "public"."cities111" to "authenticated";

grant delete on table "public"."cities111" to "service_role";

grant insert on table "public"."cities111" to "service_role";

grant references on table "public"."cities111" to "service_role";

grant select on table "public"."cities111" to "service_role";

grant trigger on table "public"."cities111" to "service_role";

grant truncate on table "public"."cities111" to "service_role";

grant update on table "public"."cities111" to "service_role";

grant delete on table "public"."content_blocks" to "anon";

grant insert on table "public"."content_blocks" to "anon";

grant references on table "public"."content_blocks" to "anon";

grant select on table "public"."content_blocks" to "anon";

grant trigger on table "public"."content_blocks" to "anon";

grant truncate on table "public"."content_blocks" to "anon";

grant update on table "public"."content_blocks" to "anon";

grant delete on table "public"."content_blocks" to "authenticated";

grant insert on table "public"."content_blocks" to "authenticated";

grant references on table "public"."content_blocks" to "authenticated";

grant select on table "public"."content_blocks" to "authenticated";

grant trigger on table "public"."content_blocks" to "authenticated";

grant truncate on table "public"."content_blocks" to "authenticated";

grant update on table "public"."content_blocks" to "authenticated";

grant delete on table "public"."content_blocks" to "service_role";

grant insert on table "public"."content_blocks" to "service_role";

grant references on table "public"."content_blocks" to "service_role";

grant select on table "public"."content_blocks" to "service_role";

grant trigger on table "public"."content_blocks" to "service_role";

grant truncate on table "public"."content_blocks" to "service_role";

grant update on table "public"."content_blocks" to "service_role";

grant delete on table "public"."content_blocks111" to "anon";

grant insert on table "public"."content_blocks111" to "anon";

grant references on table "public"."content_blocks111" to "anon";

grant select on table "public"."content_blocks111" to "anon";

grant trigger on table "public"."content_blocks111" to "anon";

grant truncate on table "public"."content_blocks111" to "anon";

grant update on table "public"."content_blocks111" to "anon";

grant delete on table "public"."content_blocks111" to "authenticated";

grant insert on table "public"."content_blocks111" to "authenticated";

grant references on table "public"."content_blocks111" to "authenticated";

grant select on table "public"."content_blocks111" to "authenticated";

grant trigger on table "public"."content_blocks111" to "authenticated";

grant truncate on table "public"."content_blocks111" to "authenticated";

grant update on table "public"."content_blocks111" to "authenticated";

grant delete on table "public"."content_blocks111" to "service_role";

grant insert on table "public"."content_blocks111" to "service_role";

grant references on table "public"."content_blocks111" to "service_role";

grant select on table "public"."content_blocks111" to "service_role";

grant trigger on table "public"."content_blocks111" to "service_role";

grant truncate on table "public"."content_blocks111" to "service_role";

grant update on table "public"."content_blocks111" to "service_role";

grant delete on table "public"."design_tokens" to "anon";

grant insert on table "public"."design_tokens" to "anon";

grant references on table "public"."design_tokens" to "anon";

grant select on table "public"."design_tokens" to "anon";

grant trigger on table "public"."design_tokens" to "anon";

grant truncate on table "public"."design_tokens" to "anon";

grant update on table "public"."design_tokens" to "anon";

grant delete on table "public"."design_tokens" to "authenticated";

grant insert on table "public"."design_tokens" to "authenticated";

grant references on table "public"."design_tokens" to "authenticated";

grant select on table "public"."design_tokens" to "authenticated";

grant trigger on table "public"."design_tokens" to "authenticated";

grant truncate on table "public"."design_tokens" to "authenticated";

grant update on table "public"."design_tokens" to "authenticated";

grant delete on table "public"."design_tokens" to "service_role";

grant insert on table "public"."design_tokens" to "service_role";

grant references on table "public"."design_tokens" to "service_role";

grant select on table "public"."design_tokens" to "service_role";

grant trigger on table "public"."design_tokens" to "service_role";

grant truncate on table "public"."design_tokens" to "service_role";

grant update on table "public"."design_tokens" to "service_role";

grant delete on table "public"."faqs" to "anon";

grant insert on table "public"."faqs" to "anon";

grant references on table "public"."faqs" to "anon";

grant select on table "public"."faqs" to "anon";

grant trigger on table "public"."faqs" to "anon";

grant truncate on table "public"."faqs" to "anon";

grant update on table "public"."faqs" to "anon";

grant delete on table "public"."faqs" to "authenticated";

grant insert on table "public"."faqs" to "authenticated";

grant references on table "public"."faqs" to "authenticated";

grant select on table "public"."faqs" to "authenticated";

grant trigger on table "public"."faqs" to "authenticated";

grant truncate on table "public"."faqs" to "authenticated";

grant update on table "public"."faqs" to "authenticated";

grant delete on table "public"."faqs" to "service_role";

grant insert on table "public"."faqs" to "service_role";

grant references on table "public"."faqs" to "service_role";

grant select on table "public"."faqs" to "service_role";

grant trigger on table "public"."faqs" to "service_role";

grant truncate on table "public"."faqs" to "service_role";

grant update on table "public"."faqs" to "service_role";

grant delete on table "public"."fleet_category_amenities" to "anon";

grant insert on table "public"."fleet_category_amenities" to "anon";

grant references on table "public"."fleet_category_amenities" to "anon";

grant select on table "public"."fleet_category_amenities" to "anon";

grant trigger on table "public"."fleet_category_amenities" to "anon";

grant truncate on table "public"."fleet_category_amenities" to "anon";

grant update on table "public"."fleet_category_amenities" to "anon";

grant delete on table "public"."fleet_category_amenities" to "authenticated";

grant insert on table "public"."fleet_category_amenities" to "authenticated";

grant references on table "public"."fleet_category_amenities" to "authenticated";

grant select on table "public"."fleet_category_amenities" to "authenticated";

grant trigger on table "public"."fleet_category_amenities" to "authenticated";

grant truncate on table "public"."fleet_category_amenities" to "authenticated";

grant update on table "public"."fleet_category_amenities" to "authenticated";

grant delete on table "public"."fleet_category_amenities" to "service_role";

grant insert on table "public"."fleet_category_amenities" to "service_role";

grant references on table "public"."fleet_category_amenities" to "service_role";

grant select on table "public"."fleet_category_amenities" to "service_role";

grant trigger on table "public"."fleet_category_amenities" to "service_role";

grant truncate on table "public"."fleet_category_amenities" to "service_role";

grant update on table "public"."fleet_category_amenities" to "service_role";

grant delete on table "public"."headers" to "anon";

grant insert on table "public"."headers" to "anon";

grant references on table "public"."headers" to "anon";

grant select on table "public"."headers" to "anon";

grant trigger on table "public"."headers" to "anon";

grant truncate on table "public"."headers" to "anon";

grant update on table "public"."headers" to "anon";

grant delete on table "public"."headers" to "authenticated";

grant insert on table "public"."headers" to "authenticated";

grant references on table "public"."headers" to "authenticated";

grant select on table "public"."headers" to "authenticated";

grant trigger on table "public"."headers" to "authenticated";

grant truncate on table "public"."headers" to "authenticated";

grant update on table "public"."headers" to "authenticated";

grant delete on table "public"."headers" to "service_role";

grant insert on table "public"."headers" to "service_role";

grant references on table "public"."headers" to "service_role";

grant select on table "public"."headers" to "service_role";

grant trigger on table "public"."headers" to "service_role";

grant truncate on table "public"."headers" to "service_role";

grant update on table "public"."headers" to "service_role";

grant delete on table "public"."heroes1" to "anon";

grant insert on table "public"."heroes1" to "anon";

grant references on table "public"."heroes1" to "anon";

grant select on table "public"."heroes1" to "anon";

grant trigger on table "public"."heroes1" to "anon";

grant truncate on table "public"."heroes1" to "anon";

grant update on table "public"."heroes1" to "anon";

grant delete on table "public"."heroes1" to "authenticated";

grant insert on table "public"."heroes1" to "authenticated";

grant references on table "public"."heroes1" to "authenticated";

grant select on table "public"."heroes1" to "authenticated";

grant trigger on table "public"."heroes1" to "authenticated";

grant truncate on table "public"."heroes1" to "authenticated";

grant update on table "public"."heroes1" to "authenticated";

grant delete on table "public"."heroes1" to "service_role";

grant insert on table "public"."heroes1" to "service_role";

grant references on table "public"."heroes1" to "service_role";

grant select on table "public"."heroes1" to "service_role";

grant trigger on table "public"."heroes1" to "service_role";

grant truncate on table "public"."heroes1" to "service_role";

grant update on table "public"."heroes1" to "service_role";

grant delete on table "public"."heroes1_archive" to "anon";

grant insert on table "public"."heroes1_archive" to "anon";

grant references on table "public"."heroes1_archive" to "anon";

grant select on table "public"."heroes1_archive" to "anon";

grant trigger on table "public"."heroes1_archive" to "anon";

grant truncate on table "public"."heroes1_archive" to "anon";

grant update on table "public"."heroes1_archive" to "anon";

grant delete on table "public"."heroes1_archive" to "authenticated";

grant insert on table "public"."heroes1_archive" to "authenticated";

grant references on table "public"."heroes1_archive" to "authenticated";

grant select on table "public"."heroes1_archive" to "authenticated";

grant trigger on table "public"."heroes1_archive" to "authenticated";

grant truncate on table "public"."heroes1_archive" to "authenticated";

grant update on table "public"."heroes1_archive" to "authenticated";

grant delete on table "public"."heroes1_archive" to "service_role";

grant insert on table "public"."heroes1_archive" to "service_role";

grant references on table "public"."heroes1_archive" to "service_role";

grant select on table "public"."heroes1_archive" to "service_role";

grant trigger on table "public"."heroes1_archive" to "service_role";

grant truncate on table "public"."heroes1_archive" to "service_role";

grant update on table "public"."heroes1_archive" to "service_role";

grant delete on table "public"."homepage_hero" to "anon";

grant insert on table "public"."homepage_hero" to "anon";

grant references on table "public"."homepage_hero" to "anon";

grant select on table "public"."homepage_hero" to "anon";

grant trigger on table "public"."homepage_hero" to "anon";

grant truncate on table "public"."homepage_hero" to "anon";

grant update on table "public"."homepage_hero" to "anon";

grant delete on table "public"."homepage_hero" to "authenticated";

grant insert on table "public"."homepage_hero" to "authenticated";

grant references on table "public"."homepage_hero" to "authenticated";

grant select on table "public"."homepage_hero" to "authenticated";

grant trigger on table "public"."homepage_hero" to "authenticated";

grant truncate on table "public"."homepage_hero" to "authenticated";

grant update on table "public"."homepage_hero" to "authenticated";

grant delete on table "public"."homepage_hero" to "service_role";

grant insert on table "public"."homepage_hero" to "service_role";

grant references on table "public"."homepage_hero" to "service_role";

grant select on table "public"."homepage_hero" to "service_role";

grant trigger on table "public"."homepage_hero" to "service_role";

grant truncate on table "public"."homepage_hero" to "service_role";

grant update on table "public"."homepage_hero" to "service_role";

grant delete on table "public"."images111" to "anon";

grant insert on table "public"."images111" to "anon";

grant references on table "public"."images111" to "anon";

grant select on table "public"."images111" to "anon";

grant trigger on table "public"."images111" to "anon";

grant truncate on table "public"."images111" to "anon";

grant update on table "public"."images111" to "anon";

grant delete on table "public"."images111" to "authenticated";

grant insert on table "public"."images111" to "authenticated";

grant references on table "public"."images111" to "authenticated";

grant select on table "public"."images111" to "authenticated";

grant trigger on table "public"."images111" to "authenticated";

grant truncate on table "public"."images111" to "authenticated";

grant update on table "public"."images111" to "authenticated";

grant delete on table "public"."images111" to "service_role";

grant insert on table "public"."images111" to "service_role";

grant references on table "public"."images111" to "service_role";

grant select on table "public"."images111" to "service_role";

grant trigger on table "public"."images111" to "service_role";

grant truncate on table "public"."images111" to "service_role";

grant update on table "public"."images111" to "service_role";

grant delete on table "public"."longform111" to "anon";

grant insert on table "public"."longform111" to "anon";

grant references on table "public"."longform111" to "anon";

grant select on table "public"."longform111" to "anon";

grant trigger on table "public"."longform111" to "anon";

grant truncate on table "public"."longform111" to "anon";

grant update on table "public"."longform111" to "anon";

grant delete on table "public"."longform111" to "authenticated";

grant insert on table "public"."longform111" to "authenticated";

grant references on table "public"."longform111" to "authenticated";

grant select on table "public"."longform111" to "authenticated";

grant trigger on table "public"."longform111" to "authenticated";

grant truncate on table "public"."longform111" to "authenticated";

grant update on table "public"."longform111" to "authenticated";

grant delete on table "public"."longform111" to "service_role";

grant insert on table "public"."longform111" to "service_role";

grant references on table "public"."longform111" to "service_role";

grant select on table "public"."longform111" to "service_role";

grant trigger on table "public"."longform111" to "service_role";

grant truncate on table "public"."longform111" to "service_role";

grant update on table "public"."longform111" to "service_role";

grant delete on table "public"."page_sections" to "anon";

grant insert on table "public"."page_sections" to "anon";

grant references on table "public"."page_sections" to "anon";

grant select on table "public"."page_sections" to "anon";

grant trigger on table "public"."page_sections" to "anon";

grant truncate on table "public"."page_sections" to "anon";

grant update on table "public"."page_sections" to "anon";

grant delete on table "public"."page_sections" to "authenticated";

grant insert on table "public"."page_sections" to "authenticated";

grant references on table "public"."page_sections" to "authenticated";

grant select on table "public"."page_sections" to "authenticated";

grant trigger on table "public"."page_sections" to "authenticated";

grant truncate on table "public"."page_sections" to "authenticated";

grant update on table "public"."page_sections" to "authenticated";

grant delete on table "public"."page_sections" to "service_role";

grant insert on table "public"."page_sections" to "service_role";

grant references on table "public"."page_sections" to "service_role";

grant select on table "public"."page_sections" to "service_role";

grant trigger on table "public"."page_sections" to "service_role";

grant truncate on table "public"."page_sections" to "service_role";

grant update on table "public"."page_sections" to "service_role";

grant delete on table "public"."pages" to "anon";

grant insert on table "public"."pages" to "anon";

grant references on table "public"."pages" to "anon";

grant select on table "public"."pages" to "anon";

grant trigger on table "public"."pages" to "anon";

grant truncate on table "public"."pages" to "anon";

grant update on table "public"."pages" to "anon";

grant delete on table "public"."pages" to "authenticated";

grant insert on table "public"."pages" to "authenticated";

grant references on table "public"."pages" to "authenticated";

grant select on table "public"."pages" to "authenticated";

grant trigger on table "public"."pages" to "authenticated";

grant truncate on table "public"."pages" to "authenticated";

grant update on table "public"."pages" to "authenticated";

grant delete on table "public"."pages" to "service_role";

grant insert on table "public"."pages" to "service_role";

grant references on table "public"."pages" to "service_role";

grant select on table "public"."pages" to "service_role";

grant trigger on table "public"."pages" to "service_role";

grant truncate on table "public"."pages" to "service_role";

grant update on table "public"."pages" to "service_role";

grant delete on table "public"."poll_categories1" to "anon";

grant insert on table "public"."poll_categories1" to "anon";

grant references on table "public"."poll_categories1" to "anon";

grant select on table "public"."poll_categories1" to "anon";

grant trigger on table "public"."poll_categories1" to "anon";

grant truncate on table "public"."poll_categories1" to "anon";

grant update on table "public"."poll_categories1" to "anon";

grant delete on table "public"."poll_categories1" to "authenticated";

grant insert on table "public"."poll_categories1" to "authenticated";

grant references on table "public"."poll_categories1" to "authenticated";

grant select on table "public"."poll_categories1" to "authenticated";

grant trigger on table "public"."poll_categories1" to "authenticated";

grant truncate on table "public"."poll_categories1" to "authenticated";

grant update on table "public"."poll_categories1" to "authenticated";

grant delete on table "public"."poll_categories1" to "service_role";

grant insert on table "public"."poll_categories1" to "service_role";

grant references on table "public"."poll_categories1" to "service_role";

grant select on table "public"."poll_categories1" to "service_role";

grant trigger on table "public"."poll_categories1" to "service_role";

grant truncate on table "public"."poll_categories1" to "service_role";

grant update on table "public"."poll_categories1" to "service_role";

grant delete on table "public"."poll_options" to "anon";

grant insert on table "public"."poll_options" to "anon";

grant references on table "public"."poll_options" to "anon";

grant select on table "public"."poll_options" to "anon";

grant trigger on table "public"."poll_options" to "anon";

grant truncate on table "public"."poll_options" to "anon";

grant update on table "public"."poll_options" to "anon";

grant delete on table "public"."poll_options" to "authenticated";

grant insert on table "public"."poll_options" to "authenticated";

grant references on table "public"."poll_options" to "authenticated";

grant select on table "public"."poll_options" to "authenticated";

grant trigger on table "public"."poll_options" to "authenticated";

grant truncate on table "public"."poll_options" to "authenticated";

grant update on table "public"."poll_options" to "authenticated";

grant delete on table "public"."poll_options" to "service_role";

grant insert on table "public"."poll_options" to "service_role";

grant references on table "public"."poll_options" to "service_role";

grant select on table "public"."poll_options" to "service_role";

grant trigger on table "public"."poll_options" to "service_role";

grant truncate on table "public"."poll_options" to "service_role";

grant update on table "public"."poll_options" to "service_role";

grant delete on table "public"."poll_options1" to "anon";

grant insert on table "public"."poll_options1" to "anon";

grant references on table "public"."poll_options1" to "anon";

grant select on table "public"."poll_options1" to "anon";

grant trigger on table "public"."poll_options1" to "anon";

grant truncate on table "public"."poll_options1" to "anon";

grant update on table "public"."poll_options1" to "anon";

grant delete on table "public"."poll_options1" to "authenticated";

grant insert on table "public"."poll_options1" to "authenticated";

grant references on table "public"."poll_options1" to "authenticated";

grant select on table "public"."poll_options1" to "authenticated";

grant trigger on table "public"."poll_options1" to "authenticated";

grant truncate on table "public"."poll_options1" to "authenticated";

grant update on table "public"."poll_options1" to "authenticated";

grant delete on table "public"."poll_options1" to "service_role";

grant insert on table "public"."poll_options1" to "service_role";

grant references on table "public"."poll_options1" to "service_role";

grant select on table "public"."poll_options1" to "service_role";

grant trigger on table "public"."poll_options1" to "service_role";

grant truncate on table "public"."poll_options1" to "service_role";

grant update on table "public"."poll_options1" to "service_role";

grant delete on table "public"."poll_options_new" to "anon";

grant insert on table "public"."poll_options_new" to "anon";

grant references on table "public"."poll_options_new" to "anon";

grant select on table "public"."poll_options_new" to "anon";

grant trigger on table "public"."poll_options_new" to "anon";

grant truncate on table "public"."poll_options_new" to "anon";

grant update on table "public"."poll_options_new" to "anon";

grant delete on table "public"."poll_options_new" to "authenticated";

grant insert on table "public"."poll_options_new" to "authenticated";

grant references on table "public"."poll_options_new" to "authenticated";

grant select on table "public"."poll_options_new" to "authenticated";

grant trigger on table "public"."poll_options_new" to "authenticated";

grant truncate on table "public"."poll_options_new" to "authenticated";

grant update on table "public"."poll_options_new" to "authenticated";

grant delete on table "public"."poll_options_new" to "service_role";

grant insert on table "public"."poll_options_new" to "service_role";

grant references on table "public"."poll_options_new" to "service_role";

grant select on table "public"."poll_options_new" to "service_role";

grant trigger on table "public"."poll_options_new" to "service_role";

grant truncate on table "public"."poll_options_new" to "service_role";

grant update on table "public"."poll_options_new" to "service_role";

grant delete on table "public"."poll_votes" to "anon";

grant insert on table "public"."poll_votes" to "anon";

grant references on table "public"."poll_votes" to "anon";

grant select on table "public"."poll_votes" to "anon";

grant trigger on table "public"."poll_votes" to "anon";

grant truncate on table "public"."poll_votes" to "anon";

grant update on table "public"."poll_votes" to "anon";

grant delete on table "public"."poll_votes" to "authenticated";

grant insert on table "public"."poll_votes" to "authenticated";

grant references on table "public"."poll_votes" to "authenticated";

grant select on table "public"."poll_votes" to "authenticated";

grant trigger on table "public"."poll_votes" to "authenticated";

grant truncate on table "public"."poll_votes" to "authenticated";

grant update on table "public"."poll_votes" to "authenticated";

grant delete on table "public"."poll_votes" to "service_role";

grant insert on table "public"."poll_votes" to "service_role";

grant references on table "public"."poll_votes" to "service_role";

grant select on table "public"."poll_votes" to "service_role";

grant trigger on table "public"."poll_votes" to "service_role";

grant truncate on table "public"."poll_votes" to "service_role";

grant update on table "public"."poll_votes" to "service_role";

grant delete on table "public"."poll_votes1" to "anon";

grant insert on table "public"."poll_votes1" to "anon";

grant references on table "public"."poll_votes1" to "anon";

grant select on table "public"."poll_votes1" to "anon";

grant trigger on table "public"."poll_votes1" to "anon";

grant truncate on table "public"."poll_votes1" to "anon";

grant update on table "public"."poll_votes1" to "anon";

grant delete on table "public"."poll_votes1" to "authenticated";

grant insert on table "public"."poll_votes1" to "authenticated";

grant references on table "public"."poll_votes1" to "authenticated";

grant select on table "public"."poll_votes1" to "authenticated";

grant trigger on table "public"."poll_votes1" to "authenticated";

grant truncate on table "public"."poll_votes1" to "authenticated";

grant update on table "public"."poll_votes1" to "authenticated";

grant delete on table "public"."poll_votes1" to "service_role";

grant insert on table "public"."poll_votes1" to "service_role";

grant references on table "public"."poll_votes1" to "service_role";

grant select on table "public"."poll_votes1" to "service_role";

grant trigger on table "public"."poll_votes1" to "service_role";

grant truncate on table "public"."poll_votes1" to "service_role";

grant update on table "public"."poll_votes1" to "service_role";

grant delete on table "public"."poll_votes_new" to "anon";

grant insert on table "public"."poll_votes_new" to "anon";

grant references on table "public"."poll_votes_new" to "anon";

grant select on table "public"."poll_votes_new" to "anon";

grant trigger on table "public"."poll_votes_new" to "anon";

grant truncate on table "public"."poll_votes_new" to "anon";

grant update on table "public"."poll_votes_new" to "anon";

grant delete on table "public"."poll_votes_new" to "authenticated";

grant insert on table "public"."poll_votes_new" to "authenticated";

grant references on table "public"."poll_votes_new" to "authenticated";

grant select on table "public"."poll_votes_new" to "authenticated";

grant trigger on table "public"."poll_votes_new" to "authenticated";

grant truncate on table "public"."poll_votes_new" to "authenticated";

grant update on table "public"."poll_votes_new" to "authenticated";

grant delete on table "public"."poll_votes_new" to "service_role";

grant insert on table "public"."poll_votes_new" to "service_role";

grant references on table "public"."poll_votes_new" to "service_role";

grant select on table "public"."poll_votes_new" to "service_role";

grant trigger on table "public"."poll_votes_new" to "service_role";

grant truncate on table "public"."poll_votes_new" to "service_role";

grant update on table "public"."poll_votes_new" to "service_role";

grant delete on table "public"."polls" to "anon";

grant insert on table "public"."polls" to "anon";

grant references on table "public"."polls" to "anon";

grant select on table "public"."polls" to "anon";

grant trigger on table "public"."polls" to "anon";

grant truncate on table "public"."polls" to "anon";

grant update on table "public"."polls" to "anon";

grant delete on table "public"."polls" to "authenticated";

grant insert on table "public"."polls" to "authenticated";

grant references on table "public"."polls" to "authenticated";

grant select on table "public"."polls" to "authenticated";

grant trigger on table "public"."polls" to "authenticated";

grant truncate on table "public"."polls" to "authenticated";

grant update on table "public"."polls" to "authenticated";

grant delete on table "public"."polls" to "service_role";

grant insert on table "public"."polls" to "service_role";

grant references on table "public"."polls" to "service_role";

grant select on table "public"."polls" to "service_role";

grant trigger on table "public"."polls" to "service_role";

grant truncate on table "public"."polls" to "service_role";

grant update on table "public"."polls" to "service_role";

grant delete on table "public"."polls1" to "anon";

grant insert on table "public"."polls1" to "anon";

grant references on table "public"."polls1" to "anon";

grant select on table "public"."polls1" to "anon";

grant trigger on table "public"."polls1" to "anon";

grant truncate on table "public"."polls1" to "anon";

grant update on table "public"."polls1" to "anon";

grant delete on table "public"."polls1" to "authenticated";

grant insert on table "public"."polls1" to "authenticated";

grant references on table "public"."polls1" to "authenticated";

grant select on table "public"."polls1" to "authenticated";

grant trigger on table "public"."polls1" to "authenticated";

grant truncate on table "public"."polls1" to "authenticated";

grant update on table "public"."polls1" to "authenticated";

grant delete on table "public"."polls1" to "service_role";

grant insert on table "public"."polls1" to "service_role";

grant references on table "public"."polls1" to "service_role";

grant select on table "public"."polls1" to "service_role";

grant trigger on table "public"."polls1" to "service_role";

grant truncate on table "public"."polls1" to "service_role";

grant update on table "public"."polls1" to "service_role";

grant delete on table "public"."polls1_backup" to "anon";

grant insert on table "public"."polls1_backup" to "anon";

grant references on table "public"."polls1_backup" to "anon";

grant select on table "public"."polls1_backup" to "anon";

grant trigger on table "public"."polls1_backup" to "anon";

grant truncate on table "public"."polls1_backup" to "anon";

grant update on table "public"."polls1_backup" to "anon";

grant delete on table "public"."polls1_backup" to "authenticated";

grant insert on table "public"."polls1_backup" to "authenticated";

grant references on table "public"."polls1_backup" to "authenticated";

grant select on table "public"."polls1_backup" to "authenticated";

grant trigger on table "public"."polls1_backup" to "authenticated";

grant truncate on table "public"."polls1_backup" to "authenticated";

grant update on table "public"."polls1_backup" to "authenticated";

grant delete on table "public"."polls1_backup" to "service_role";

grant insert on table "public"."polls1_backup" to "service_role";

grant references on table "public"."polls1_backup" to "service_role";

grant select on table "public"."polls1_backup" to "service_role";

grant trigger on table "public"."polls1_backup" to "service_role";

grant truncate on table "public"."polls1_backup" to "service_role";

grant update on table "public"."polls1_backup" to "service_role";

grant delete on table "public"."polls_new" to "anon";

grant insert on table "public"."polls_new" to "anon";

grant references on table "public"."polls_new" to "anon";

grant select on table "public"."polls_new" to "anon";

grant trigger on table "public"."polls_new" to "anon";

grant truncate on table "public"."polls_new" to "anon";

grant update on table "public"."polls_new" to "anon";

grant delete on table "public"."polls_new" to "authenticated";

grant insert on table "public"."polls_new" to "authenticated";

grant references on table "public"."polls_new" to "authenticated";

grant select on table "public"."polls_new" to "authenticated";

grant trigger on table "public"."polls_new" to "authenticated";

grant truncate on table "public"."polls_new" to "authenticated";

grant update on table "public"."polls_new" to "authenticated";

grant delete on table "public"."polls_new" to "service_role";

grant insert on table "public"."polls_new" to "service_role";

grant references on table "public"."polls_new" to "service_role";

grant select on table "public"."polls_new" to "service_role";

grant trigger on table "public"."polls_new" to "service_role";

grant truncate on table "public"."polls_new" to "service_role";

grant update on table "public"."polls_new" to "service_role";

grant delete on table "public"."reviews" to "anon";

grant insert on table "public"."reviews" to "anon";

grant references on table "public"."reviews" to "anon";

grant select on table "public"."reviews" to "anon";

grant trigger on table "public"."reviews" to "anon";

grant truncate on table "public"."reviews" to "anon";

grant update on table "public"."reviews" to "anon";

grant delete on table "public"."reviews" to "authenticated";

grant insert on table "public"."reviews" to "authenticated";

grant references on table "public"."reviews" to "authenticated";

grant select on table "public"."reviews" to "authenticated";

grant trigger on table "public"."reviews" to "authenticated";

grant truncate on table "public"."reviews" to "authenticated";

grant update on table "public"."reviews" to "authenticated";

grant delete on table "public"."reviews" to "service_role";

grant insert on table "public"."reviews" to "service_role";

grant references on table "public"."reviews" to "service_role";

grant select on table "public"."reviews" to "service_role";

grant trigger on table "public"."reviews" to "service_role";

grant truncate on table "public"."reviews" to "service_role";

grant update on table "public"."reviews" to "service_role";

grant delete on table "public"."site_settings" to "anon";

grant insert on table "public"."site_settings" to "anon";

grant references on table "public"."site_settings" to "anon";

grant select on table "public"."site_settings" to "anon";

grant trigger on table "public"."site_settings" to "anon";

grant truncate on table "public"."site_settings" to "anon";

grant update on table "public"."site_settings" to "anon";

grant delete on table "public"."site_settings" to "authenticated";

grant insert on table "public"."site_settings" to "authenticated";

grant references on table "public"."site_settings" to "authenticated";

grant select on table "public"."site_settings" to "authenticated";

grant trigger on table "public"."site_settings" to "authenticated";

grant truncate on table "public"."site_settings" to "authenticated";

grant update on table "public"."site_settings" to "authenticated";

grant delete on table "public"."site_settings" to "service_role";

grant insert on table "public"."site_settings" to "service_role";

grant references on table "public"."site_settings" to "service_role";

grant select on table "public"."site_settings" to "service_role";

grant trigger on table "public"."site_settings" to "service_role";

grant truncate on table "public"."site_settings" to "service_role";

grant update on table "public"."site_settings" to "service_role";

grant delete on table "public"."sites" to "anon";

grant insert on table "public"."sites" to "anon";

grant references on table "public"."sites" to "anon";

grant select on table "public"."sites" to "anon";

grant trigger on table "public"."sites" to "anon";

grant truncate on table "public"."sites" to "anon";

grant update on table "public"."sites" to "anon";

grant delete on table "public"."sites" to "authenticated";

grant insert on table "public"."sites" to "authenticated";

grant references on table "public"."sites" to "authenticated";

grant select on table "public"."sites" to "authenticated";

grant trigger on table "public"."sites" to "authenticated";

grant truncate on table "public"."sites" to "authenticated";

grant update on table "public"."sites" to "authenticated";

grant delete on table "public"."sites" to "service_role";

grant insert on table "public"."sites" to "service_role";

grant references on table "public"."sites" to "service_role";

grant select on table "public"."sites" to "service_role";

grant trigger on table "public"."sites" to "service_role";

grant truncate on table "public"."sites" to "service_role";

grant update on table "public"."sites" to "service_role";

grant delete on table "public"."states" to "anon";

grant insert on table "public"."states" to "anon";

grant references on table "public"."states" to "anon";

grant select on table "public"."states" to "anon";

grant trigger on table "public"."states" to "anon";

grant truncate on table "public"."states" to "anon";

grant update on table "public"."states" to "anon";

grant delete on table "public"."states" to "authenticated";

grant insert on table "public"."states" to "authenticated";

grant references on table "public"."states" to "authenticated";

grant select on table "public"."states" to "authenticated";

grant trigger on table "public"."states" to "authenticated";

grant truncate on table "public"."states" to "authenticated";

grant update on table "public"."states" to "authenticated";

grant delete on table "public"."states" to "service_role";

grant insert on table "public"."states" to "service_role";

grant references on table "public"."states" to "service_role";

grant select on table "public"."states" to "service_role";

grant trigger on table "public"."states" to "service_role";

grant truncate on table "public"."states" to "service_role";

grant update on table "public"."states" to "service_role";

grant delete on table "public"."style_tokens" to "anon";

grant insert on table "public"."style_tokens" to "anon";

grant references on table "public"."style_tokens" to "anon";

grant select on table "public"."style_tokens" to "anon";

grant trigger on table "public"."style_tokens" to "anon";

grant truncate on table "public"."style_tokens" to "anon";

grant update on table "public"."style_tokens" to "anon";

grant delete on table "public"."style_tokens" to "authenticated";

grant insert on table "public"."style_tokens" to "authenticated";

grant references on table "public"."style_tokens" to "authenticated";

grant select on table "public"."style_tokens" to "authenticated";

grant trigger on table "public"."style_tokens" to "authenticated";

grant truncate on table "public"."style_tokens" to "authenticated";

grant update on table "public"."style_tokens" to "authenticated";

grant delete on table "public"."style_tokens" to "service_role";

grant insert on table "public"."style_tokens" to "service_role";

grant references on table "public"."style_tokens" to "service_role";

grant select on table "public"."style_tokens" to "service_role";

grant trigger on table "public"."style_tokens" to "service_role";

grant truncate on table "public"."style_tokens" to "service_role";

grant update on table "public"."style_tokens" to "service_role";

grant delete on table "public"."tags" to "anon";

grant insert on table "public"."tags" to "anon";

grant references on table "public"."tags" to "anon";

grant select on table "public"."tags" to "anon";

grant trigger on table "public"."tags" to "anon";

grant truncate on table "public"."tags" to "anon";

grant update on table "public"."tags" to "anon";

grant delete on table "public"."tags" to "authenticated";

grant insert on table "public"."tags" to "authenticated";

grant references on table "public"."tags" to "authenticated";

grant select on table "public"."tags" to "authenticated";

grant trigger on table "public"."tags" to "authenticated";

grant truncate on table "public"."tags" to "authenticated";

grant update on table "public"."tags" to "authenticated";

grant delete on table "public"."tags" to "service_role";

grant insert on table "public"."tags" to "service_role";

grant references on table "public"."tags" to "service_role";

grant select on table "public"."tags" to "service_role";

grant trigger on table "public"."tags" to "service_role";

grant truncate on table "public"."tags" to "service_role";

grant update on table "public"."tags" to "service_role";

grant delete on table "public"."themes" to "anon";

grant insert on table "public"."themes" to "anon";

grant references on table "public"."themes" to "anon";

grant select on table "public"."themes" to "anon";

grant trigger on table "public"."themes" to "anon";

grant truncate on table "public"."themes" to "anon";

grant update on table "public"."themes" to "anon";

grant delete on table "public"."themes" to "authenticated";

grant insert on table "public"."themes" to "authenticated";

grant references on table "public"."themes" to "authenticated";

grant select on table "public"."themes" to "authenticated";

grant trigger on table "public"."themes" to "authenticated";

grant truncate on table "public"."themes" to "authenticated";

grant update on table "public"."themes" to "authenticated";

grant delete on table "public"."themes" to "service_role";

grant insert on table "public"."themes" to "service_role";

grant references on table "public"."themes" to "service_role";

grant select on table "public"."themes" to "service_role";

grant trigger on table "public"."themes" to "service_role";

grant truncate on table "public"."themes" to "service_role";

grant update on table "public"."themes" to "service_role";

grant delete on table "public"."tool_code" to "anon";

grant insert on table "public"."tool_code" to "anon";

grant references on table "public"."tool_code" to "anon";

grant select on table "public"."tool_code" to "anon";

grant trigger on table "public"."tool_code" to "anon";

grant truncate on table "public"."tool_code" to "anon";

grant update on table "public"."tool_code" to "anon";

grant delete on table "public"."tool_code" to "authenticated";

grant insert on table "public"."tool_code" to "authenticated";

grant references on table "public"."tool_code" to "authenticated";

grant select on table "public"."tool_code" to "authenticated";

grant trigger on table "public"."tool_code" to "authenticated";

grant truncate on table "public"."tool_code" to "authenticated";

grant update on table "public"."tool_code" to "authenticated";

grant delete on table "public"."tool_code" to "service_role";

grant insert on table "public"."tool_code" to "service_role";

grant references on table "public"."tool_code" to "service_role";

grant select on table "public"."tool_code" to "service_role";

grant trigger on table "public"."tool_code" to "service_role";

grant truncate on table "public"."tool_code" to "service_role";

grant update on table "public"."tool_code" to "service_role";

grant delete on table "public"."tool_placements" to "anon";

grant insert on table "public"."tool_placements" to "anon";

grant references on table "public"."tool_placements" to "anon";

grant select on table "public"."tool_placements" to "anon";

grant trigger on table "public"."tool_placements" to "anon";

grant truncate on table "public"."tool_placements" to "anon";

grant update on table "public"."tool_placements" to "anon";

grant delete on table "public"."tool_placements" to "authenticated";

grant insert on table "public"."tool_placements" to "authenticated";

grant references on table "public"."tool_placements" to "authenticated";

grant select on table "public"."tool_placements" to "authenticated";

grant trigger on table "public"."tool_placements" to "authenticated";

grant truncate on table "public"."tool_placements" to "authenticated";

grant update on table "public"."tool_placements" to "authenticated";

grant delete on table "public"."tool_placements" to "service_role";

grant insert on table "public"."tool_placements" to "service_role";

grant references on table "public"."tool_placements" to "service_role";

grant select on table "public"."tool_placements" to "service_role";

grant trigger on table "public"."tool_placements" to "service_role";

grant truncate on table "public"."tool_placements" to "service_role";

grant update on table "public"."tool_placements" to "service_role";

grant delete on table "public"."tool_runs" to "anon";

grant insert on table "public"."tool_runs" to "anon";

grant references on table "public"."tool_runs" to "anon";

grant select on table "public"."tool_runs" to "anon";

grant trigger on table "public"."tool_runs" to "anon";

grant truncate on table "public"."tool_runs" to "anon";

grant update on table "public"."tool_runs" to "anon";

grant delete on table "public"."tool_runs" to "authenticated";

grant insert on table "public"."tool_runs" to "authenticated";

grant references on table "public"."tool_runs" to "authenticated";

grant select on table "public"."tool_runs" to "authenticated";

grant trigger on table "public"."tool_runs" to "authenticated";

grant truncate on table "public"."tool_runs" to "authenticated";

grant update on table "public"."tool_runs" to "authenticated";

grant delete on table "public"."tool_runs" to "service_role";

grant insert on table "public"."tool_runs" to "service_role";

grant references on table "public"."tool_runs" to "service_role";

grant select on table "public"."tool_runs" to "service_role";

grant trigger on table "public"."tool_runs" to "service_role";

grant truncate on table "public"."tool_runs" to "service_role";

grant update on table "public"."tool_runs" to "service_role";

grant delete on table "public"."tools" to "anon";

grant insert on table "public"."tools" to "anon";

grant references on table "public"."tools" to "anon";

grant select on table "public"."tools" to "anon";

grant trigger on table "public"."tools" to "anon";

grant truncate on table "public"."tools" to "anon";

grant update on table "public"."tools" to "anon";

grant delete on table "public"."tools" to "authenticated";

grant insert on table "public"."tools" to "authenticated";

grant references on table "public"."tools" to "authenticated";

grant select on table "public"."tools" to "authenticated";

grant trigger on table "public"."tools" to "authenticated";

grant truncate on table "public"."tools" to "authenticated";

grant update on table "public"."tools" to "authenticated";

grant delete on table "public"."tools" to "service_role";

grant insert on table "public"."tools" to "service_role";

grant references on table "public"."tools" to "service_role";

grant select on table "public"."tools" to "service_role";

grant trigger on table "public"."tools" to "service_role";

grant truncate on table "public"."tools" to "service_role";

grant update on table "public"."tools" to "service_role";

grant delete on table "public"."vehicle_categories" to "anon";

grant insert on table "public"."vehicle_categories" to "anon";

grant references on table "public"."vehicle_categories" to "anon";

grant select on table "public"."vehicle_categories" to "anon";

grant trigger on table "public"."vehicle_categories" to "anon";

grant truncate on table "public"."vehicle_categories" to "anon";

grant update on table "public"."vehicle_categories" to "anon";

grant delete on table "public"."vehicle_categories" to "authenticated";

grant insert on table "public"."vehicle_categories" to "authenticated";

grant references on table "public"."vehicle_categories" to "authenticated";

grant select on table "public"."vehicle_categories" to "authenticated";

grant trigger on table "public"."vehicle_categories" to "authenticated";

grant truncate on table "public"."vehicle_categories" to "authenticated";

grant update on table "public"."vehicle_categories" to "authenticated";

grant delete on table "public"."vehicle_categories" to "service_role";

grant insert on table "public"."vehicle_categories" to "service_role";

grant references on table "public"."vehicle_categories" to "service_role";

grant select on table "public"."vehicle_categories" to "service_role";

grant trigger on table "public"."vehicle_categories" to "service_role";

grant truncate on table "public"."vehicle_categories" to "service_role";

grant update on table "public"."vehicle_categories" to "service_role";

grant delete on table "public"."vehicle_images11" to "anon";

grant insert on table "public"."vehicle_images11" to "anon";

grant references on table "public"."vehicle_images11" to "anon";

grant select on table "public"."vehicle_images11" to "anon";

grant trigger on table "public"."vehicle_images11" to "anon";

grant truncate on table "public"."vehicle_images11" to "anon";

grant update on table "public"."vehicle_images11" to "anon";

grant delete on table "public"."vehicle_images11" to "authenticated";

grant insert on table "public"."vehicle_images11" to "authenticated";

grant references on table "public"."vehicle_images11" to "authenticated";

grant select on table "public"."vehicle_images11" to "authenticated";

grant trigger on table "public"."vehicle_images11" to "authenticated";

grant truncate on table "public"."vehicle_images11" to "authenticated";

grant update on table "public"."vehicle_images11" to "authenticated";

grant delete on table "public"."vehicle_images11" to "service_role";

grant insert on table "public"."vehicle_images11" to "service_role";

grant references on table "public"."vehicle_images11" to "service_role";

grant select on table "public"."vehicle_images11" to "service_role";

grant trigger on table "public"."vehicle_images11" to "service_role";

grant truncate on table "public"."vehicle_images11" to "service_role";

grant update on table "public"."vehicle_images11" to "service_role";

grant delete on table "public"."vehicle_pages111" to "anon";

grant insert on table "public"."vehicle_pages111" to "anon";

grant references on table "public"."vehicle_pages111" to "anon";

grant select on table "public"."vehicle_pages111" to "anon";

grant trigger on table "public"."vehicle_pages111" to "anon";

grant truncate on table "public"."vehicle_pages111" to "anon";

grant update on table "public"."vehicle_pages111" to "anon";

grant delete on table "public"."vehicle_pages111" to "authenticated";

grant insert on table "public"."vehicle_pages111" to "authenticated";

grant references on table "public"."vehicle_pages111" to "authenticated";

grant select on table "public"."vehicle_pages111" to "authenticated";

grant trigger on table "public"."vehicle_pages111" to "authenticated";

grant truncate on table "public"."vehicle_pages111" to "authenticated";

grant update on table "public"."vehicle_pages111" to "authenticated";

grant delete on table "public"."vehicle_pages111" to "service_role";

grant insert on table "public"."vehicle_pages111" to "service_role";

grant references on table "public"."vehicle_pages111" to "service_role";

grant select on table "public"."vehicle_pages111" to "service_role";

grant trigger on table "public"."vehicle_pages111" to "service_role";

grant truncate on table "public"."vehicle_pages111" to "service_role";

grant update on table "public"."vehicle_pages111" to "service_role";

grant delete on table "public"."vehicles11" to "anon";

grant insert on table "public"."vehicles11" to "anon";

grant references on table "public"."vehicles11" to "anon";

grant select on table "public"."vehicles11" to "anon";

grant trigger on table "public"."vehicles11" to "anon";

grant truncate on table "public"."vehicles11" to "anon";

grant update on table "public"."vehicles11" to "anon";

grant delete on table "public"."vehicles11" to "authenticated";

grant insert on table "public"."vehicles11" to "authenticated";

grant references on table "public"."vehicles11" to "authenticated";

grant select on table "public"."vehicles11" to "authenticated";

grant trigger on table "public"."vehicles11" to "authenticated";

grant truncate on table "public"."vehicles11" to "authenticated";

grant update on table "public"."vehicles11" to "authenticated";

grant delete on table "public"."vehicles11" to "service_role";

grant insert on table "public"."vehicles11" to "service_role";

grant references on table "public"."vehicles11" to "service_role";

grant select on table "public"."vehicles11" to "service_role";

grant trigger on table "public"."vehicles11" to "service_role";

grant truncate on table "public"."vehicles11" to "service_role";

grant update on table "public"."vehicles11" to "service_role";

grant delete on table "public"."vehicles_legacy" to "anon";

grant insert on table "public"."vehicles_legacy" to "anon";

grant references on table "public"."vehicles_legacy" to "anon";

grant select on table "public"."vehicles_legacy" to "anon";

grant trigger on table "public"."vehicles_legacy" to "anon";

grant truncate on table "public"."vehicles_legacy" to "anon";

grant update on table "public"."vehicles_legacy" to "anon";

grant delete on table "public"."vehicles_legacy" to "authenticated";

grant insert on table "public"."vehicles_legacy" to "authenticated";

grant references on table "public"."vehicles_legacy" to "authenticated";

grant select on table "public"."vehicles_legacy" to "authenticated";

grant trigger on table "public"."vehicles_legacy" to "authenticated";

grant truncate on table "public"."vehicles_legacy" to "authenticated";

grant update on table "public"."vehicles_legacy" to "authenticated";

grant delete on table "public"."vehicles_legacy" to "service_role";

grant insert on table "public"."vehicles_legacy" to "service_role";

grant references on table "public"."vehicles_legacy" to "service_role";

grant select on table "public"."vehicles_legacy" to "service_role";

grant trigger on table "public"."vehicles_legacy" to "service_role";

grant truncate on table "public"."vehicles_legacy" to "service_role";

grant update on table "public"."vehicles_legacy" to "service_role";

grant delete on table "public"."why_sections" to "anon";

grant insert on table "public"."why_sections" to "anon";

grant references on table "public"."why_sections" to "anon";

grant select on table "public"."why_sections" to "anon";

grant trigger on table "public"."why_sections" to "anon";

grant truncate on table "public"."why_sections" to "anon";

grant update on table "public"."why_sections" to "anon";

grant delete on table "public"."why_sections" to "authenticated";

grant insert on table "public"."why_sections" to "authenticated";

grant references on table "public"."why_sections" to "authenticated";

grant select on table "public"."why_sections" to "authenticated";

grant trigger on table "public"."why_sections" to "authenticated";

grant truncate on table "public"."why_sections" to "authenticated";

grant update on table "public"."why_sections" to "authenticated";

grant delete on table "public"."why_sections" to "service_role";

grant insert on table "public"."why_sections" to "service_role";

grant references on table "public"."why_sections" to "service_role";

grant select on table "public"."why_sections" to "service_role";

grant trigger on table "public"."why_sections" to "service_role";

grant truncate on table "public"."why_sections" to "service_role";

grant update on table "public"."why_sections" to "service_role";


  create policy "Allow public read access"
  on "public"."b2r_poll_options"
  as permissive
  for select
  to public
using (true);



  create policy "Allow anonymous voting"
  on "public"."b2r_poll_votes"
  as permissive
  for insert
  to public
with check (true);



  create policy "Allow public read access"
  on "public"."b2r_poll_votes"
  as permissive
  for select
  to public
using (true);



  create policy "Allow public read access"
  on "public"."b2r_polls"
  as permissive
  for select
  to public
using (true);



  create policy "Public read categories"
  on "public"."categories1"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "categories1_read_all"
  on "public"."categories1"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read categories"
  on "public"."categories1"
  as permissive
  for select
  to public
using (true);



  create policy "Public read cities"
  on "public"."cities"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read cities"
  on "public"."cities"
  as permissive
  for select
  to public
using (true);



  create policy "heroes1_public_read"
  on "public"."heroes1"
  as permissive
  for select
  to public
using ((is_active = true));



  create policy "public read active heroes"
  on "public"."heroes1"
  as permissive
  for select
  to anon
using ((is_active = true));



  create policy "public read hero"
  on "public"."homepage_hero"
  as permissive
  for select
  to anon
using (true);



  create policy "poll_categories1_read_all"
  on "public"."poll_categories1"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "Allow public read access to poll_options"
  on "public"."poll_options"
  as permissive
  for select
  to public
using (true);



  create policy "Enable public read access"
  on "public"."poll_options1"
  as permissive
  for select
  to anon
using (true);



  create policy "poll_options1_read_all"
  on "public"."poll_options1"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read poll_options1"
  on "public"."poll_options1"
  as permissive
  for select
  to anon
using (true);



  create policy "read_options_anon"
  on "public"."poll_options1"
  as permissive
  for select
  to anon
using (true);



  create policy "read_poll_options1"
  on "public"."poll_options1"
  as permissive
  for select
  to public
using (true);



  create policy "Public read for poll_options_new"
  on "public"."poll_options_new"
  as permissive
  for select
  to public
using (true);



  create policy "Public update for poll_options_new"
  on "public"."poll_options_new"
  as permissive
  for update
  to public
using (true)
with check (true);



  create policy "Allow public read access to poll_votes"
  on "public"."poll_votes"
  as permissive
  for select
  to public
using (true);



  create policy "insert_votes1"
  on "public"."poll_votes1"
  as permissive
  for insert
  to public
with check (true);



  create policy "insert_votes_anon"
  on "public"."poll_votes1"
  as permissive
  for insert
  to anon
with check (true);



  create policy "read_votes_anon"
  on "public"."poll_votes1"
  as permissive
  for select
  to anon
using (true);



  create policy "select_votes1"
  on "public"."poll_votes1"
  as permissive
  for select
  to public
using (true);



  create policy "Public insert for poll_votes_new"
  on "public"."poll_votes_new"
  as permissive
  for insert
  to public
with check (true);



  create policy "Public read for poll_votes_new"
  on "public"."poll_votes_new"
  as permissive
  for select
  to public
using (true);



  create policy "Allow public read access to polls"
  on "public"."polls"
  as permissive
  for select
  to public
using (true);



  create policy "polls1_read_active"
  on "public"."polls1"
  as permissive
  for select
  to anon, authenticated
using (COALESCE(is_active, true));



  create policy "polls1_read_all"
  on "public"."polls1"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read polls1"
  on "public"."polls1"
  as permissive
  for select
  to anon
using (true);



  create policy "read_polls1"
  on "public"."polls1"
  as permissive
  for select
  to public
using (true);



  create policy "read_polls1_anon"
  on "public"."polls1"
  as permissive
  for select
  to anon
using (true);



  create policy "Public read for polls_new"
  on "public"."polls_new"
  as permissive
  for select
  to public
using (true);



  create policy "Public read reviews"
  on "public"."reviews"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "reviews read"
  on "public"."reviews"
  as permissive
  for select
  to public
using (true);



  create policy "reviews write"
  on "public"."reviews"
  as permissive
  for all
  to public
using ((auth.role() = 'authenticated'::text))
with check ((auth.role() = 'authenticated'::text));



  create policy "reviews_public_read"
  on "public"."reviews"
  as permissive
  for select
  to anon, authenticated
using (COALESCE(approved, true));



  create policy "site_settings_read_all"
  on "public"."site_settings"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "Public read states"
  on "public"."states"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read states"
  on "public"."states"
  as permissive
  for select
  to public
using (true);



  create policy "Public read tags"
  on "public"."tags"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read tags"
  on "public"."tags"
  as permissive
  for select
  to public
using (true);



  create policy "public read code"
  on "public"."tool_code"
  as permissive
  for select
  to public
using (true);



  create policy "read_tool_code_anon"
  on "public"."tool_code"
  as permissive
  for select
  to anon
using (true);



  create policy "public insert runs (dev)"
  on "public"."tool_runs"
  as permissive
  for insert
  to public
with check (true);



  create policy "public read runs"
  on "public"."tool_runs"
  as permissive
  for select
  to public
using (true);



  create policy "Public read tools"
  on "public"."tools"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "tools read"
  on "public"."tools"
  as permissive
  for select
  to public
using (true);



  create policy "tools write"
  on "public"."tools"
  as permissive
  for all
  to public
using ((auth.role() = 'authenticated'::text))
with check ((auth.role() = 'authenticated'::text));



  create policy "public read vehicle_images11"
  on "public"."vehicle_images11"
  as permissive
  for select
  to public
using (true);



  create policy "public read vehicles11"
  on "public"."vehicles11"
  as permissive
  for select
  to public
using (true);



  create policy "Enable read for all"
  on "public"."vehicles_legacy"
  as permissive
  for select
  to public
using (true);



  create policy "Public read vehicles_legacy"
  on "public"."vehicles_legacy"
  as permissive
  for select
  to anon, authenticated
using (true);



  create policy "public read vehicles"
  on "public"."vehicles_legacy"
  as permissive
  for select
  to public
using (true);



  create policy "why_sections_read_all"
  on "public"."why_sections"
  as permissive
  for select
  to anon
using (true);



  create policy "why_sections_read_auth"
  on "public"."why_sections"
  as permissive
  for select
  to authenticated
using (true);



  create policy "Owner insert"
  on "tooling"."tool_code"
  as permissive
  for insert
  to authenticated
with check ((( SELECT auth.uid() AS uid) = created_by));



  create policy "Owner or admin delete"
  on "tooling"."tool_code"
  as permissive
  for delete
  to authenticated
using (((( SELECT auth.uid() AS uid) = created_by) OR ((auth.jwt() ->> 'is_admin'::text) = 'true'::text)));



  create policy "Owner or admin select"
  on "tooling"."tool_code"
  as permissive
  for select
  to authenticated
using (((( SELECT auth.uid() AS uid) = created_by) OR ((auth.jwt() ->> 'is_admin'::text) = 'true'::text)));



  create policy "Owner or admin update"
  on "tooling"."tool_code"
  as permissive
  for update
  to authenticated
using (((( SELECT auth.uid() AS uid) = created_by) OR ((auth.jwt() ->> 'is_admin'::text) = 'true'::text)))
with check (((created_by = ( SELECT auth.uid() AS uid)) OR ((auth.jwt() ->> 'is_admin'::text) = 'true'::text)));


CREATE TRIGGER trg_categories_allowlist_lower BEFORE INSERT OR UPDATE ON public.categories_allowlist FOR EACH ROW EXECUTE FUNCTION public.force_lower_slug();

CREATE TRIGGER set_updated_at_cities BEFORE UPDATE ON public.cities FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER set_updated_at_events BEFORE UPDATE ON public.events FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER set_updated_at BEFORE UPDATE ON public.pages FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER set_updated_at_pages BEFORE UPDATE ON public.pages FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER trg_max4_options1 BEFORE INSERT ON public.poll_options1 FOR EACH ROW EXECUTE FUNCTION public.enforce_max4_options1();

CREATE TRIGGER set_updated_at_sites BEFORE UPDATE ON public.sites FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER set_updated_at_states BEFORE UPDATE ON public.states FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER trg_style_tokens_updated BEFORE UPDATE ON public.style_tokens FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER set_updated_at_tools BEFORE UPDATE ON public.tools FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

CREATE TRIGGER trg_tools_timestamps BEFORE UPDATE ON public.tools FOR EACH ROW EXECUTE FUNCTION public.tg_tools_touch_updated_at();

CREATE TRIGGER trg_tools_updated BEFORE UPDATE ON public.tools FOR EACH ROW EXECUTE FUNCTION public.set_tools_updated_at();

CREATE TRIGGER trg_tool_code_updated_at BEFORE UPDATE ON tooling.tool_code FOR EACH ROW EXECUTE FUNCTION tooling.set_updated_at();


